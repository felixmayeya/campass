function initMessageInfo(e){$(".indexMessage li").remove(),$.ajax({url:"/api/notice.open?cmd=WEL:SELECTUNREADNOTICE",async:!0,cache:!1,type:"post",data:{user_id:e},success:function(t){console.log(t),messageData=t;var a="";if($(".messageNum").html(t.length),t.length>0){for(var o=0;o<t.length;o++){var n=t[o].type,s="label-info",r="fa fa-bell-o";if("1"!=n&&"2"!=n||(s="label-info"),"8"==n&&(s="label-warning"),"3"==n&&(s="label-warning"),"4"==n&&(s="label-danger",r="fa fa-bolt"),"1"==n){var l=o;"#/upload"!=location.hash&&"#/parse"!=location.hash&&"3"===localStorage.getItem("ROLE")&&"3"===localStorage.getItem("ROLE_ID")&&swal({title:("zh"==localStorage.getItem("language"),"请确认预解析"),text:t[o].content,type:"info",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"zh"==localStorage.getItem("language")?"确认":"Comfirm"},function(){uploadParse(l)}),a+='<li onclick="javascript:uploadParse('+l+');"><a><span class="time">'+t[o].time+'</span><span class="details"><span class="label label-sm label-icon '+s+'" style="padding: 4px 3px 4px 4px;"><i class="'+r+'"></i></span> '+t[o].content+" </span></a></li>"}else a+='<li><a href="javascript:closeThisMessage('+t[o].id+","+e+');"><span class="time">'+t[o].time+'</span><span class="details"><span class="label label-sm label-icon '+s+'" style="padding: 4px 3px 4px 4px;"><i class="'+r+'"></i></span> '+t[o].content+" </span></a></li>"}$(".indexMessage").append(a)}}})}function closeThisMessage(e,t){$.ajax({url:"/api/notice.open?cmd=WEL:CHANGENOTICE",async:!0,cache:!1,type:"post",data:{noticeId:e},success:function(e){initMessageInfo(t)}})}function uploadParse(e){filePath=messageData[e],console.log(filePath),localStorage.setItem("ROLE",3),localStorage.setItem("ROLE_ID",3),location.href="#/parse"}function upDateProID(){localStorage.setItem("PROJECTID",projectID),$.ajax({type:"POST",url:"/api/toppage.open?cmd=WEL:UPDATEPROJECTID",data:{projectID:projectID},async:!0,cache:!0,dataType:"json",success:function(e){}})}function ForDight(e,t){return e=Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function toDecimal2(e){var t=parseFloat(e);if(isNaN(t))return!1;var t=Math.round(100*e)/100,a=t.toString(),o=a.indexOf(".");for(o<0&&(o=a.length,a+=".");a.length<=o+2;)a+="0";return a}function addLoadEvent(e){var t=window.onresize;"function"!=typeof window.onresize?window.onresize=e:window.onresize=function(){t(),e()}}function timeZoneChange(e){var t=(new Date).getTimezoneOffset()/60;return moment(e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8)+" "+e.slice(8,10)+":"+e.slice(10,12)).add(t,"hour").format("YYYYMMDDHHmm")}var title="页面访问总量统计",btnUrl,roleID=localStorage.getItem("ROLE"),roleType=localStorage.getItem("ROLE_ID"),swiper,pageName,sessionObj={},allData,drillTime,cvrPageMark,statusArr=[],interval="",daterangeArr=Dynamic.analysis_daterangeArr;""!=localStorage.getItem("ANALYSIS_LABLE")&&null!=localStorage.getItem("ANALYSIS_LABLE")?localStorage.getItem("ANALYSIS_LABLE")==daterangeArr[0]||localStorage.getItem("ANALYSIS_LABLE")==daterangeArr[1]?interval="day":localStorage.getItem("ANALYSIS_LABLE")==daterangeArr[2]?interval="week":localStorage.getItem("ANALYSIS_LABLE")==daterangeArr[3]?interval="oneMonth":localStorage.getItem("ANALYSIS_LABLE")==daterangeArr[4]&&(interval="year"):interval="day";var _interval="";_interval=""!=localStorage.getItem("ANALYSIS_INTERVAL")&&null!=localStorage.getItem("ANALYSIS_INTERVAL")?localStorage.getItem("ANALYSIS_INTERVAL"):"hour";var analysisOnload=!0,controlMapType,storageArr,userID,projectID,projectUP="",xhr,filePath="",messageData,startTime,endTime,smChartST=[],smChartET=[],os_type,rpType,language=localStorage.getItem("language"),homeSkipMapType,Search=0,dataID=[],sprojectID="",addChartCheck=0,indexToAnalysis=!1,projectTimeArr,skipSwiper=0,skipPage,titleStartTime,titleEndTime,titleProID,skipInterval,homeMapType,indexProjectSelected=!1,newStorageArr;console.log("正在获取用户信息..."),""!=localStorage.getItem("PROJECTID")&&null!=localStorage.getItem("PROJECTID")&&(projectID=localStorage.getItem("PROJECTID")),$.ajax({async:!0,cache:!1,type:"post",url:"/api/options.open",data:{},success:function(e){$("#userAvatar_s").attr("src",e.image),$("#head_name").html(e.name),$(".avatar").attr("src",e.image),$(".username").html(e.sitename),userID=e.user_id,console.log("获取用户信息成功..."),console.log("正在获取项目ID..."),projectID=0==e.last_project?"00":e.last_project,localStorage.setItem("PROJECTID",projectID),"#home"!=location.hash&&setTimeout(function(){$(".loadingBox").fadeOut()},1e3),initMessageInfo(userID)},error:function(){console.log("获取用户信息失败")}}),setInterval(function(){initMessageInfo(userID)},6e4),Date.prototype.add=function(e,t){switch(t*=1,isNaN(t)&&(t=0),e){case"y":this.setFullYear(this.getFullYear()+t);break;case"m":this.setMonth(this.getMonth()+t);break;case"d":this.setDate(this.getDate()+t);break;case"h":this.setHours(this.getHours()+t);break;case"n":this.setMinutes(this.getMinutes()+t);break;case"s":this.setSeconds(this.getSeconds()+t)}return this},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},startTime=moment().startOf("day").format("YYYYMMDDHHmm"),endTime=moment().add(1,"d").startOf("day").format("YYYYMMDDHHmm"),$(".page-sidebar-menu").delegate(".analysisBtn","click",function(){""!=localStorage.getItem("ANALYSIS_START_TIME")&&null!=localStorage.getItem("ANALYSIS_START_TIME")&&""!=localStorage.getItem("ANALYSIS_END_TIME")&&null!=localStorage.getItem("ANALYSIS_END_TIME")&&($("#reportrange").data("daterangepicker").setStartDate(localStorage.getItem("ANALYSIS_START_TIME")),$("#reportrange").data("daterangepicker").setEndDate(localStorage.getItem("ANALYSIS_END_TIME")))});var loadingObj={text:"loading",color:"#678098",textColor:"#678098",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0};$.fn.scrollUnique=function(){return $(this).each(function(){var e="mousewheel";void 0!==document.mozHidden&&(e="DOMMouseScroll"),$(this).on(e,function(e){var t=this.scrollTop,a=this.scrollHeight,o=this.clientHeight,n=e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-(e.originalEvent.detail||0);(n>0&&t<=n||n<0&&a-o-t<=-1*n)&&(this.scrollTop=n>0?0:a,e.preventDefault())})})},$.fn.dataTable.ext.errMode=function(e,t,a){};var timeZone=-(new Date).getTimezoneOffset()/60,isMac=function(){return/macintosh|mac os x/i.test(navigator.userAgent)},isWindows=function(){return/windows|win32/i.test(navigator.userAgent)},registMap=function(e){$.get("js/map/json/"+e.toLowerCase()+".json",function(t){echarts.registerMap(e,t)})},maptype="China";"zh"===language?mapType="China":mapType="World",registMap(mapType);