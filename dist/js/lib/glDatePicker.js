!function(){$.fn.glDatePicker=function(e){var t="glDatePicker",a=this.data(t);return a?e===!0?a:this:this.each(function(){return $(this).data(t,new glDatePicker(this,e))})},$.fn.glDatePicker.defaults={format:"yyyy-mm-dd",cssName:"default",zIndex:1e3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!0,hideOnClick:!1,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"〈",nextArrow:"〉",selectableDates:null,selectableDateRange:null,specialDates:null,selectableMonths:null,selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(e,t,a,l){e.val(a.format(this.format))},onHover:function(e,t,a,l){},onShow:function(e){e.show()},onHide:function(e){e.show()},firstDate:null};var glDatePicker=function(){function glDatePicker(e,t){var a=this;a.el=$(e);var l=a.el;a.options=$.extend(!0,{},$.fn.glDatePicker.defaults,t);var n=a.options;a.calendar=$($.find("[gldp-el="+l.attr("gldp-id")+" ]")),n.selectedDate=n.selectedDate||n.todayDate,n.firstDate=new Date(n.firstDate||n.selectedDate)._first(),(l.attr("gldp-id")||"").length||l.attr("gldp-id","gldp-"+Math.round(1e10*Math.random())),l.addClass("gldp-el").bind("click",function(e){a.show(e)}).bind("focus",function(e){a.show(e)}),a.calendar.length&&!n.showAlways&&a.calendar.hide(),$(document).bind("mouseup",function(e){var t=e.target,n=a.calendar;l.is(t)||n.is(t)||0!==n.has(t).length||!n.is(":visible")||a.hide()}),a.render()}return glDatePicker.prototype={show:function(){$.each($(".gldp-el").not(this.el),function(e,t){t.length&&t.options.onHide(t.calendar)}),this.options.onShow(this.calendar)},hide:function(){this.options&&!this.options.showAlways&&this.options.onHide(this.calendar)},render:function(renderCalback){var self=this,el=self.el,options=self.options,calendar=self.calendar,coreClass=" core border ",cssName="gldp-"+options.cssName,todayVal=options.todayDate._val(),todayTime=todayVal.time,maxRow=6,maxCol=7,borderSize=options.borderSize+"px",getSelectableList=function(e,t,a){for(var l=[],n=e;n<=t;n++)l.push(n);if(a){var o=[];$.each(a,function(a,l){l>=e&&l<=t&&o.indexOf(l)<0&&o.push(l)}),l=o.length?o:l}return l.sort(),l},selectableMonths=getSelectableList(0,11,options.selectableMonths),selectableYears=getSelectableList(todayVal.year-5,todayVal.year+5,options.selectableYears),selectableDOW=getSelectableList(0,6,options.selectableDOW),dowNames=options.dowNames||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames=options.monthNames||["January","February","March","April","May","June","July","August","September","October","November","December"],containerWidth=el.outerWidth(),containerHeight=containerWidth,getCellSize=function(e,t){return e/t+options.borderSize/t*(t-1)},cellWidth=getCellSize(containerWidth,maxCol),cellHeight=getCellSize(containerHeight,maxRow+2);calendar.length?eval(calendar.data("is"))||(containerWidth=calendar.outerWidth(),containerHeight=calendar.outerHeight(),cellWidth=getCellSize(containerWidth,maxCol),cellHeight=getCellSize(containerHeight,maxRow+2)):(self.calendar=calendar=$("<div/>").attr("gldp-el",el.attr("gldp-id")).data("is",!0).css({display:options.showAlways?void 0:"none",zIndex:options.zIndex,width:cellWidth*maxCol+"px"}),$("body").append(calendar)),el.is(":visible")||calendar.hide(),calendar.removeClass().addClass(cssName).children().remove();var onResize=function(){el.offset();calendar.css({})};$(window).resize(onResize),onResize();var cellCSS={width:cellWidth-1+"px",height:cellHeight+"px",lineHeight:cellHeight+"px"},setFirstDate=function(e){e&&(options.firstDate=e,self.render())},getFirstDate=function(e){var t=new Date(options.firstDate);for(e=e||0;;){if(t.setMonth(t.getMonth()+e),t.setDate(Math.min(1,t._max())),0==e)break;var a=t._val(),l=a.month,n=a.year;if(selectableMonths.indexOf(l)!=-1){if(selectableYears.indexOf(n)!=-1)break;if(n<selectableYears[0]||n>selectableYears[selectableYears.length-1])return null}}return t},prevFirstDate=getFirstDate(-1),nextFirstDate=getFirstDate(1),firstDate=options.firstDate=getFirstDate(),firstDateVal=firstDate._val(),firstDateMonth=firstDateVal.month,firstDateYear=firstDateVal.year,startDate=new Date(firstDate),dowOffset=Math.abs(Math.min(6,Math.max(0,options.dowOffset))),startOffset=startDate.getDay()-dowOffset;startOffset=startOffset<1?-7-startOffset:-startOffset,dowNames=dowNames.concat(dowNames).slice(dowOffset,dowOffset+7),startDate._add(startOffset);var showPrev=prevFirstDate,showNext=nextFirstDate,monyearClass=coreClass+"monyear ",prevCell=$('<div class="prevArrow"/>').addClass(monyearClass).css($.extend({},cellCSS,{height:cellHeight-8+"px",lineHeight:cellHeight-7+"px",marginLeft:"-"+borderSize})).append($("<<a/>").addClass("prev-arrow"+(showPrev?"":"-off"))).mousedown(function(){return!1}).click(function(e){""!=options.prevArrow&&showPrev&&(e.stopPropagation(),setFirstDate(prevFirstDate))}),prevYearCell=$('<div class="yearPrevArrow"/>').addClass(monyearClass).css($.extend({},cellCSS,{height:cellHeight-8+"px",lineHeight:cellHeight-7+"px",marginLeft:"-"+borderSize})).append($("<<a/>").addClass("prev-arrow"+(showPrev?"":"-off"))).mousedown(function(){return!1}).click(function(e){if(""!=options.nextArrow&&showNext){e.stopPropagation();for(var t=document.getElementsByClassName("yearSelect")[0],a=parseInt(yearSelect.val())-1,l=0;l<t.options.length;l++)if(t.options[l].innerHTML==a){$(".yearSelect option").removeAttr("selected"),t.options[l].setAttribute("selected","selected");break}$(".titleYear>span").html(yearSelect.val()),onYearMonthSelect()}}),titleCellCount=maxCol-2,titleWidth=cellWidth*titleCellCount-titleCellCount*options.borderSize+options.borderSize,titleCell=$("<div/>").addClass(monyearClass+"title monTitle").css($.extend({},cellCSS,{width:titleWidth+"px",height:cellHeight-8+"px",lineHeight:cellHeight-7.5+"px",borderTopWidth:borderSize})),titleCellYear=$("<div/>").addClass(monyearClass+"title yearTitle").css($.extend({},cellCSS,{width:titleWidth+"px",height:cellHeight-8+"px",lineHeight:cellHeight-7.5+"px",borderTopWidth:borderSize})),nextCell=$('<div class="nextArrow"/>').addClass(monyearClass).css($.extend({},cellCSS,{height:cellHeight-8+"px",lineHeight:cellHeight-7+"px",borderWidth:borderSize+" "+borderSize+" 0 0"})).append($("<a/>>").addClass("next-arrow"+(showNext?"":"-off"))).mousedown(function(){return!1}).click(function(e){""!=options.nextArrow&&showNext&&(e.stopPropagation(),setFirstDate(nextFirstDate))}),nextYearCell=$('<div class="yearNextArrow"/>').addClass(monyearClass).css($.extend({},cellCSS,{height:cellHeight-8+"px",lineHeight:cellHeight-7+"px",borderWidth:borderSize+" "+borderSize+" 0 0"})).append($("<a/>>").addClass("next-arrow"+(showNext?"":"-off"))).mousedown(function(){return!1}).click(function(e){if(""!=options.nextArrow&&showNext){e.stopPropagation();for(var t=document.getElementsByClassName("yearSelect")[0],a=parseInt(yearSelect.val())+1,l=0;l<t.options.length;l++)if(t.options[l].innerHTML==a){$(".yearSelect option").removeAttr("selected"),t.options[l].setAttribute("selected","selected");break}$(".titleYear>span").html(yearSelect.val()),onYearMonthSelect()}});calendar.append(prevYearCell).append(titleCellYear).append(nextYearCell).append(prevCell).append(titleCell).append(nextCell);for(var row=0,cellIndex=0;row<maxRow+1;row++)for(var col=0;col<maxCol;col++,cellIndex++){var cellDate=new Date(startDate),cellClass="day",cellZIndex=options.zIndex+cellIndex,cell=$("<div/>");if(row){cellDate._add(col+(row-1)*maxCol);var cellDateVal=cellDate._val(),cellDateTime=cellDateVal.time,specialData=null,isSelectable=!0,getRepeatDate=function(e,t){return e.repeatYear===!0&&t.setYear(cellDateVal.year),e.repeatMonth===!0&&t.setMonth(cellDateVal.month),t._val()};cell.html(cellDateVal.date),options.selectableDateRange&&(isSelectable=!1,$.each(options.selectableDateRange,function(e,t){var a=t.from,l=t.to||null;if(l=l||new Date(t.from.getFullYear(),t.from.getMonth(),t.from._max()),a=getRepeatDate(t,a),l=getRepeatDate(t,l),cellDateTime>=a.time&&cellDateTime<=l.time)return isSelectable=!0,!0})),options.selectableDates&&((options.selectableDateRange&&!isSelectable||isSelectable&&!options.selectableDateRange)&&(isSelectable=!1),$.each(options.selectableDates,function(e,t){var a=getRepeatDate(t,t.date);if(a.time==cellDateTime)return isSelectable=!0})),!isSelectable||selectableYears.indexOf(cellDateVal.year)<0||selectableMonths.indexOf(cellDateVal.month)<0||selectableDOW.indexOf(cellDateVal.day)<0?cellClass="noday":(cellClass=["sun","mon","tue","wed","thu","fri","sat"][cellDateVal.day],firstDateMonth!=cellDateVal.month&&(cellClass+=" outday"),todayTime==cellDateTime&&(cellClass="today",cellZIndex+=50),options.selectedDate._time()==cellDateTime&&(cellClass="selected",cellZIndex+=51),options.specialDates&&$.each(options.specialDates,function(e,t){var a=getRepeatDate(t,t.date);a.time==cellDateTime&&(cellClass=t.cssClass||"special",cellZIndex+=52,specialData=t.data)}),cell.mousedown(function(){return!1}).hover(function(e){e.stopPropagation();var t=$(this).data("data");options.onHover(el,cell,t.date,t.data)}).click(function(e){if(1==allAjaxCheck){e.stopPropagation();var t=$(this).data("data");options.selectedDate=options.firstDate=t.date,self.render(function(){!options.showAlways&&options.hideOnClick&&self.hide()}),options.onClick(el,$(this),t.date,t.data)}}))}else cellClass="dow",cell.html(dowNames[col]),cellDate=null;$.extend(cellCSS,{borderTopWidth:borderSize,borderBottomWidth:borderSize,borderLeftWidth:row>0||!row&&!col?borderSize:0,borderRightWidth:row>0||!row&&6==col?borderSize:0,marginLeft:col>0?"-"+borderSize:0,marginTop:row>0?"-"+borderSize:0,zIndex:cellZIndex}),cell.data("data",{date:cellDate,data:specialData}).addClass(coreClass+cellClass).css(cellCSS),calendar.append(cell)}var onYearMonthSelect=function(){options.firstDate=new Date(yearSelect.val(),monthSelect.val(),1),self.render()},monthSelect=$("<select/>").hide().change(onYearMonthSelect),yearSelect=$('<select class="yearSelect"/>').hide().change(onYearMonthSelect),monthText=$("<span/>").html(monthNames[firstDateMonth]).mousedown(function(){return!1}).click(function(e){e.stopPropagation()}),yearText=$("<span/>").html(firstDateYear).mousedown(function(){return!1}).click(function(e){e.stopPropagation()});$.each(monthNames,function(e,t){if(options.allowMonthSelect&&selectableMonths.indexOf(e)!=-1){var a=$("<option/>").html(t).attr("value",e);e==firstDateMonth&&a.attr("selected","selected"),monthSelect.append(a)}}),$.each(selectableYears,function(e,t){if(options.allowYearSelect){var a=$("<option/>").html(t).attr("value",t);t==firstDateYear&&a.attr("selected","selected"),yearSelect.append(a)}});var titleYear=$('<div class="titleYear" />').append(yearText).append(yearSelect),titleMonth=$('<div class="titleMonth" />').append(monthText).append(monthSelect);titleCell.children().remove(),titleCellYear.append(titleYear),titleCell.append(titleMonth),(renderCalback=renderCalback||function(){})()}},glDatePicker}(),dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,l=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(n,o,i){var s=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(n)||/\d/.test(n)||(o=n,n=void 0),n=n?new Date(n):new Date,isNaN(n))throw SyntaxError("invalid date");o=String(s.masks[o]||o||s.masks.default),"UTC:"==o.slice(0,4)&&(o=o.slice(4),i=!0);var r=i?"getUTC":"get",c=n[r+"Date"](),d=n[r+"Day"](),h=n[r+"Month"](),p=n[r+"FullYear"](),m=n[r+"Hours"](),f=n[r+"Minutes"](),u=n[r+"Seconds"](),g=n[r+"Milliseconds"](),D=i?0:n.getTimezoneOffset(),y={d:c,dd:l(c),ddd:s.i18n.dayNames[d],dddd:s.i18n.dayNames[d+7],m:h+1,mm:l(h+1),mmm:s.i18n.monthNames[h],mmmm:s.i18n.monthNames[h+12],yy:String(p).slice(2),yyyy:p,h:m%12||12,hh:l(m%12||12),H:m,HH:l(m),M:f,MM:l(f),s:u,ss:l(u),l:l(g,3),L:l(g>99?Math.round(g/10):g),t:m<12?"a":"p",tt:m<12?"am":"pm",T:m<12?"A":"P",TT:m<12?"AM":"PM",Z:i?"UTC":(String(n).match(t)||[""]).pop().replace(a,""),o:(D>0?"-":"+")+l(100*Math.floor(Math.abs(D)/60)+Math.abs(D)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return o.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},function(){Date.prototype._clear=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.format=function(e,t){return dateFormat(this,e,t)},Date.prototype._time=function(){return this._clear().getTime()},Date.prototype._max=function(){var e=1==new Date(this.getYear(),1,29).getMonth()?1:0,t=[31,28+e,31,30,31,30,31,31,30,31,30,31];return t[this.getMonth()]},Date.prototype._add=function(e){this.setDate(this.getDate()+e)},Date.prototype._first=function(){var e=new Date(this);return e.setDate(1),e},Date.prototype._val=function(){return this._clear(),{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()}}}()}();