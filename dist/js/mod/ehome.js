define(["text!/tpl/ehome.html","css!/css/ehome.css","jqueryUi"],function(t){function e(){function e(){$.ajax({async:!0,type:"GET",dataType:"json",url:"/api/monitortask.open?cmd=WEL:GETALLTASK",success:function(t){if(null!=t.homeOrder){var e=t.homeOrder.reporttype.split(","),o="",n=[];$.each(t.monitortask,function(t,e){var n=a(e.frequency,e.time_units),i=a(e.range,e.range_units),r="",l="";r=null==e.detailstart_date?"":e.detailstart_date,l=null==e.detailend_date?"":e.detailend_date;var c="";""==e.email?c="":""!=e.email&&0==e.send_mail?c=' <button type="button" class="btn yellow btn-outline uppercase memail ladda-button" data-status="1" data-style="zoom-in"><span class="ladda-label">'+Dynamic.ehome_yemail+"</span></button>":""!=e.email&&1==e.send_mail&&(c=' <button type="button" class="btn yellow btn-outline uppercase memail ladda-button" data-status="0" data-style="zoom-in"><span class="ladda-label">'+Dynamic.ehome_nemail+"</span></button>"),o+='<li class="portlet portlet-sortable col-lg-6 col-xs-12 col-sm-12 portbox" style="padding:15px;margin-bottom:0;" data-key="'+e.key_word+'" data-id="'+e.id+'" data-proid="'+e.project_id+'">\t\t\t\t\t\t\t\t\t<div class="portlet light bordered port1" style="margin-bottom:0;">\t\t\t\t\t\t\t\t\t\t<div class="portlet-title ui-sortable-handle porttitle">\t\t\t\t\t\t\t\t\t\t\t<div class="caption">&nbsp;\t\t\t\t\t\t\t\t\t\t\t\t<span class="titleProIdSpan">'+e.project_name+'</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<div class="actions">\t\t\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn green btn-outline uppercase mesearch">'+Dynamic.emonitor_detail+'</button>\t\t\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn blue btn-outline uppercase medetail">'+Dynamic.emonitor_godetail+"</button>"+c+'<i class="fa fa-close mission_del"></i>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class="portlet-body row">\t\t\t\t\t\t\t\t\t\t\t<div class="col-xs-12 leftport">\t\t\t\t\t\t\t\t\t\t\t\t<h1>'+e.data_count+'<e data-i18n="ehome_allProject">'+Dynamic.emonitor_span+"</e></h1>\t\t\t\t\t\t\t\t\t\t\t\t<p>"+r+" -- "+l+'</p>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<div class="col-xs-12 rightport">\t\t\t\t\t\t\t\t\t\t\t\t<p><b>'+Dynamic.emonitor_cont+"</b>："+e.key_word+"</p>\t\t\t\t\t\t\t\t\t\t\t\t<p><b>"+Dynamic.emonitor_project+"</b>："+e.project_name+"</p>\t\t\t\t\t\t\t\t\t\t\t\t<p><b>"+Dynamic.emonitor_frequency+"</b>："+n+"</p>\t\t\t\t\t\t\t\t\t\t\t\t<p><b>"+Dynamic.emonitor_range+"</b>："+i+"</p>\t\t\t\t\t\t\t\t\t\t\t\t<p><b>"+Dynamic.emonitor_create+"</b>："+e.input_date+"</p>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</li>"}),$("#portable").prepend(o),$.each(e,function(t){n.push($("#portable li[data-id='"+this+"']"))}),$("#portable li").remove(),$("#portable").prepend(n)}}})}$(".page-content").html(t),changeLanguage("ehome"),$("#selectProject").selectpicker({width:"auto",title:Dynamic.home_chooseTxt,size:10}),$.ajax({url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:roleID},success:function(t){$("#selectProject").empty(),$("#selectProject").append('<option data-id="all" data-i18n="ehome_allProject">'+Dynamic.home_chooseTxt+"</option>");for(var e=0;e<t.use.length;e++)$("#selectProject").append("<option value="+t.use[e].name+" data-id="+t.use[e].id+">"+t.use[e].name+"</option>");$("#selectProject").selectpicker("render"),$("#selectProject").selectpicker("refresh")}}),"1"==localStorage.getItem("OPTION_PACKAGE")&&(window.location.href="#/package",localStorage.setItem("OPTION_PACKAGE",0));var a=function(t,e){var a;return"MM"==e?a=t+Dynamic.emonitor_t_s:"HH"==e?a=t/60+Dynamic.emonitor_t_h:"DD"==e?a=t/1440+Dynamic.emonitor_t_d:"WW"==e&&(a=t/10080+Dynamic.emonitor_t_w),a};e(),$("#portable").sortable({revert:330,distance:50,forcePlaceholderSize:!0,items:"li",handle:".portlet-title",containment:"body",update:function(){var t=[];$(".portbox").each(function(){t.push($(this).attr("data-id"))});var e=t.join(",");$.ajax({type:"post",url:"/api/monitortask.open?cmd=WEL:INSERTHOMEPAGE",data:{reporttype:e},success:function(t){storageArr=newStorageArr},error:function(){console.log(Dynamic.strings_senderror)}})}}),$("#selectProject").change(function(){var t=$("#selectProject").find("option:selected").attr("data-id");$("#portable li").hide(),"all"==t?$("#portable li").show():$("#portable li[data-proid='"+t+"']").show()}),$("body").delegate(".mission_del","click",function(){var t=$(this).parents(".portbox").attr("data-id");swal({title:Dynamic.home_delete,text:"",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.home_ok,cancelButtonText:Dynamic.home_cancel,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({type:"post",url:"/api/monitortask.open?cmd=WEL:DELETEMONITORTASK",data:{monitor_id:t},success:function(){swal({title:Dynamic.home_deletesuc,confirmButtonText:Dynamic.home_ok,type:"success"},function(){$("#portable li").remove(),e()})},error:function(){console.log(Dynamic.strings_senderror)}})})}),$("body").delegate(".medetail","click",function(){localStorage.setItem("MESEARCH",$(this).parents("li").attr("data-id")),location.href="#/task_detail"}),$("body").delegate(".mesearch","click",function(){localStorage.setItem("SEARCH_PID",$(this).parents("li").attr("data-proid")),localStorage.setItem("SEARCH_KEY",$(this).parents("li").attr("data-key")),location.href="#/search"}),$("body").delegate(".memail","click",function(){var t=$(this),e=Ladda.create(this);e.start();var a=t.parents(".portbox").attr("data-id"),o=t.attr("data-status");$.ajax({type:"post",url:"/api/monitortask.open?cmd=WEL:CANCELEMAIL",data:{monitor_id:a,changeEmailStatus:o},success:function(){0==o?swal({title:Dynamic.ehome_nemailA,confirmButtonText:Dynamic.home_ok,type:"success"},function(){t.attr("data-status","1").html(Dynamic.ehome_yemail),e.stop()}):swal({title:Dynamic.ehome_yemailA,confirmButtonText:Dynamic.home_ok,type:"success"},function(){t.attr("data-status","0").html(Dynamic.ehome_nemail),e.stop()})},error:function(){console.log(Dynamic.strings_senderror)}})})}return{render:e}});