define(["text!/tpl/options.html"],function(a){function t(){$(".page-content").html(a),changeLanguage("options");var t=Dynamic.option_ok;$.ajax({async:!0,cache:!1,type:"post",url:"/api/options.open",data:{},success:function(a){$("#user_id").val(a.user_id),$(".userinfo_title>span").eq(0).html(a.user_id),$("#pass").val(a.password),$("#sitename").val(a.sitename),$("#email").val(a.email),$("#phone").val(a.phone),$("#company").val(a.company),$("#company2").val(a.company),$("#userAvatar").attr("src",a.image),$("#avatarExplainImg").attr("src",a.image),$("#userAvatar_s").attr("src",a.image),$("#company span").html(a.company),$("#name_h span").html(a.sitename)}}),$("#saveAvatar").click(function(){var a=Dynamic.option_avatarsuc,e=Dynamic.option_avatarfaild;$.ajax({async:!0,cache:!1,type:"post",dataType:"json",url:"/api/options.open?cmd=WEL:UPDATE",data:{headImgDataUrl:n},success:function(n){"success"==n.statu&&swal({title:a,confirmButtonText:t,type:"success"},function(){$(".profile-userpic img").attr("src",$("#avatarExplainImg").attr("src")),$(".avatar").attr("src",$("#avatarExplainImg").attr("src"))})},error:function(){swal({title:"",text:e,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1})}})}),$("#btnsave").click(function(){var a=$("#sitename").val(),e=$("#email").val(),o=$("#company2").val(),s=$("#phone").val(),i=Dynamic.option_canotempty,c=Dynamic.option_emailerr,r=Dynamic.option_phoneerr,l=Dynamic.option_savesuc,p=Dynamic.option_savefaild;if(""==a||""==e||""==o||""==s)return void swal({title:"",text:i,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1});var m=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return m.test(e)?/^1(3|4|5|7|8)\d{9}$/.test(s)?void $.ajax({async:!0,cache:!1,type:"post",dataType:"json",url:"/api/options.open?cmd=WEL:UPDATE",data:{sitename:$("#sitename").val(),email:$("#email").val(),phone:$("#phone").val(),company:$("#company2").val(),headImgDataUrl:n},success:function(a){$(".username").html($("#sitename").val()),$(".profile-usermenu>.nav>li:eq(0) h4 span").html($("#sitename").val()),"success"==a.statu&&swal({title:l,confirmButtonText:t,type:"success"},function(){})},error:function(){swal({title:"",text:p,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1})}}):(swal({title:"",text:r,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1}),$("#phone").val(""),!1):(swal({title:c,type:"error",confirmButtonText:t,closeOnConfirm:!1}),$("#email").val(""),!1)}),$.ajax({type:"get",url:"/api/user.open?cmd=WEL:UPGRADEPACKAGE",async:!0,cache:!0,dataType:"json",success:function(a){var t;$.each(a,function(){t+="<tr><td>"+this.role_name+"</td><td>"+this.begin_time+" -- "+this.end_time+"</td><td>"+this.data_config+'GB</td><td><a class="btn blue btn-outline updataCombo" data-id="'+this.role_id+'" data-type="'+this.product_id+'">'+Dynamic.notice_options_UpgradePackage+"</a></td></tr>",console.log(this)}),$("#tab_1_4 table tbody").html(t)}}),$("body").delegate(".updataCombo","click",function(){localStorage.setItem("ROLE",$(this).attr("data-id")),localStorage.setItem("ROLE_ID",$(this).attr("data-type")),localStorage.setItem("OPTION_PACKAGE",1),window.location.href="/index.html"}),$("#btnreset").click(function(){$.ajax({async:!0,cache:!1,type:"post",dataType:"json",url:"/api/options.open?cmd=WEL:RESET",data:{sitename:$("#sitename").val()},success:function(a){"success"==a.statu&&($("#sitename").val(a.sitename),$("#email").val(a.email),$("#phone").val(a.phone),$("#company").val(a.company))},error:function(){swal({title:"Session过期，请重新登录！",text:"",type:"info",confirmButtonText:t,closeOnConfirm:!1},function(){window.location.href="index.html"})}})}),$("#changeAvatarBtn").click(function(){$(".changeAvatarBox").css("display","block")});var n;$("body").delegate("#headImg","change",function(){var a=this.files[0];if(window.FileReader){var t=new FileReader;t.onloadend=function(a){n=a.target.result,$("#avatarExplainImg").attr("src",n)},t.readAsDataURL(a)}}),$(".changeAvatarCancel").click(function(){$(".changeAvatarBox").css("display","none"),$(".changeAvatarInput").css("display","block"),$(".changeAvatarPreview").css("display","none");var a=$("#headImg");a.after(a.clone().val("")),a.remove()}),$(".changeAvatarExplainCheck").click(function(){$(".changeAvatarBox").css("display","none"),$(".changeAvatarInput").css("display","block"),$(".changeAvatarPreview").css("display","none"),document.getElementsByClassName("headImg")[0].style.backgroundImage="url("+n+")";var a=$("#headImg");a.after(a.clone().val("")),a.remove()}),$("#btnPassSave").click(function(){var a=$("#pass").val(),n=$("#password").val(),e=$("#npassword").val(),o=$("#rpassword").val(),s=Dynamic.option_passwordErr1,i=Dynamic.option_passwordErr2,c=Dynamic.option_passwordErr3,r=Dynamic.option_passwordSuc;$.ajax({async:!1,cache:!1,type:"post",dataType:"json",url:"/api/options.open?cmd=WEL:VALIDATEPASSWORD",data:{pass:a,password:n},success:function(a){return"fail"==a?(swal({title:"",text:s,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1}),$("#password").val(""),$("#npassword").val(""),void $("#rpassword").val("")):e!=o?(swal({title:"",text:i,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1}),$("#password").val(""),$("#npassword").val(""),void $("#rpassword").val("")):null==o||""==o?(swal({title:"",text:c,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:t,closeOnConfirm:!1}),$("#password").val(""),$("#npassword").val(""),void $("#rpassword").val("")):void $.ajax({async:!1,cache:!1,type:"post",dataType:"json",url:"/api/options.open?cmd=WEL:RESETPASSWORD",data:{user_id:$("#user_id").val(),password:e},success:function(a){swal({title:r,confirmButtonText:t,type:"success"},function(){window.location.href="index.html"})},error:function(){swal({title:"Session过期，请重新登录！",text:"",type:"info",confirmButtonText:t,closeOnConfirm:!1},function(){window.location.href="index.html"})}})},error:function(){swal({title:"Session过期，请重新登录！",text:"",type:"info",confirmButtonText:t,closeOnConfirm:!1},function(){window.location.href="index.html"})}})}),$("#btnPassReset").click(function(){$("#password").val(""),$("#npassword").val(""),$("#rpassword").val("")})}return{render:t}});