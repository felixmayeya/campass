define(["text!/tpl/emonitor.html","chart","css!/css/emonitor.css"],function(t,e){function a(){$(".page-content").html(t),changeLanguage("emonitor"),$(".chartablebox").scrollUnique();var a,n="",o="",i="",r="",c="",s="",d=localStorage.getItem("MESEARCH");localStorage.setItem("MESEARCH",""),$("#linecharts").width($(".chartbox").width()-40).height(250);var l=new e.Chart($("#linecharts"),{type:"lineplot",legend:!1,showTitle:!1,toolboxType:"basic",title:Dynamic.homeCharts_title17});l.showLoading(),window.onresize=function(){$("#linecharts").width($(".chartbox").width()-40),l.resize()};var m=function(){$(".sname").html(o),$(".skey").html(i),$(".sfreq").html(r),$(".srange").html(c),$(".screat").html(s)},u=function(t){n=t.attr("data-id"),o=t.attr("data-pro"),i=t.attr("data-key"),r=t.attr("data-fre"),c=t.attr("data-range"),s=t.attr("data-creat")},p=function(t){a=$("#chartable").dataTable({language:Lang,autoWidth:!1,paging:!0,lengthChange:!0,searching:!1,ordering:!1,processing:!0,serverSide:!0,pagingType:"full_numbers",deferRender:!0,ajax:function(e,a,n){var o={pageSize:e.length,currentPage:e.start/e.length+1,monitor_id:t};l.showLoading(),$.ajax({type:"GET",async:!0,data:o,url:"/api/monitortask.open?cmd=WEL:GETMONITORTASKLIST",dataType:"json",success:function(t){var n={};n.draw=e.draw,n.recordsTotal=t.count,n.recordsFiltered=t.count,n.data=t.datadetail,a(n);var o=[],i=[];$.each(n.data,function(t){o.push(this.input_date),i.push(this.data_count)});var r={xAxis:{name:"",data:o},yAxis:{},series:[{name:Dynamic.emonitor_yside,data:i}]};l.injectData(r),l.hideLoading()}})},columns:[{data:"start_date"},{data:"end_date"},{data:"data_count"}],initComplete:function(t,e){}}).api()},h=function(t,e){var a;return"MM"==e?a=t+Dynamic.emonitor_t_s:"HH"==e?a=t/60+Dynamic.emonitor_t_h:"DD"==e?a=t/1440+Dynamic.emonitor_t_d:"WW"==e&&(a=t/10080+Dynamic.emonitor_t_w),a},y=function(){$("#selectD").selectpicker("destroy"),$("#selectD").find("option").remove(),$.ajax({type:"get",async:"true",url:"/api/monitortask.open?cmd=WEL:GETALLMONITORTASK",success:function(t){for(var e="",o=0;o<t.length;o++){var i=h(t[o].frequency,t[o].time_units),r=h(t[o].range,t[o].range_units);e+="<option data-id='"+t[o].id+"' data-pro='"+t[o].project_name+"' data-key='"+t[o].key_word+"' data-fre='"+i+"' data-range='"+r+"' data-creat='"+t[o].input_date+"'>"+t[o].project_name+"--"+t[o].key_word+"--"+Dynamic.emonitor_fre+"："+i+"</option>"}$("#selectD").append(e),$("#selectD").selectpicker({width:"auto",title:Dynamic.search_select,size:10});var c=$("#selectD option:nth-of-type(2)");$("#selectD").selectpicker("val",c.html()),u(c),a.destroy(),$("#chartable tbody tr").remove(),p(n),m()}})},f=function(){$("#selectD").selectpicker({width:"auto",title:Dynamic.search_select,size:10}),$.ajax({type:"get",async:"true",url:"/api/monitortask.open?cmd=WEL:GETALLMONITORTASK",success:function(t){for(var e="",a=0;a<t.length;a++){var o=h(t[a].frequency,t[a].time_units),i=h(t[a].range,t[a].range_units);e+="<option data-id='"+t[a].id+"' data-pro='"+t[a].project_name+"' data-key='"+t[a].key_word+"' data-fre='"+o+"' data-range='"+i+"' data-creat='"+t[a].input_date+"'>"+t[a].project_name+"--"+t[a].key_word+"--"+Dynamic.emonitor_fre+"："+o+"</option>"}if($("#selectD").append(e),$("#selectD").selectpicker("render"),$("#selectD").selectpicker("refresh"),""===d||null==d){var r=$("#selectD option:nth-of-type(2)");$("#selectD").selectpicker("val",r.html()),u(r)}else{var c=$("#selectD option[data-id='"+d+"']");$("#selectD").selectpicker("val",c.html()),u(c)}p(n),m()}}),$("#selectD").on("change",function(){var t=$(this).find("option:selected");u(t),a.destroy(),$("#chartable tbody tr").remove(),p(n),m()}),$("#delmiss").on("click",function(){swal({title:Dynamic.home_delete,text:"",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.home_ok,cancelButtonText:Dynamic.home_cancel,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({type:"post",url:"/api/monitortask.open?cmd=WEL:DELETEMONITORTASK",data:{monitor_id:n},success:function(){swal({title:Dynamic.home_deletesuc,confirmButtonText:Dynamic.home_ok,type:"success"},function(){y()})},error:function(){console.log(Dynamic.strings_senderror)}})})}),$("#downloadcsv").on("click",function(){window.location.href="/api/download.open?cmd=WEL:REPORTESONLYCSV&monitor_id="+n+"&os_type="+(isMac()?"mac":"")})};f()}return{render:a}});