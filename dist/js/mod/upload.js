function getNowFormatDate(){var t=new Date,e="-",a=":",o=t.getMonth()+1,n=t.getDate();o>=1&&o<=9&&(o="0"+o),n>=0&&n<=9&&(n="0"+n);var i=t.getHours();i>=1&&i<=9&&(i="0"+i);var s=t.getMinutes();s>=1&&s<=9&&(s="0"+s);var l=t.getSeconds();l>=1&&l<=9&&(l="0"+l);var c=t.getFullYear()+e+o+e+n+" "+i+a+s+a+l;return c}define(["text!/tpl/upload.html","jqueryForm"],function(t){function e(){var e,a,o="",n="",i="",s="",l="";$(".page-content").html(t),changeLanguage("upload");var c=Dynamic.upload_ok,p=(Dynamic.upload_confirm,Dynamic.upload_skipStep),r=Dynamic.upload_Attachment,d=Dynamic.upload_StreamingData,u=Dynamic.upload_submitBtntips1,m=Dynamic.upload_submitBtntips2,f=Dynamic.upload_submitBtntips3,_=Dynamic.upload_submitBtntips4,y=Dynamic.upload_submitBtntips5,h=Dynamic.upload_submitBtntips6,v=(Dynamic.upload_submitBtntips7,Dynamic.upload_submitBtntips8),x=Dynamic.upload_submitBtntips9,g=Dynamic.upload_submitBtntips10,D=Dynamic.upload_submitBtntips11,w=Dynamic.upload_submitBtntips12,b=Dynamic.upload_submitBtntips13;2==roleType&&($("#excelItem").hide(),$(".upLoadAStep").remove(),$("#submitBtn").html(Dynamic.upload_up),m=Dynamic.upload_submitBtntips15),$.ajax({url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:roleID},success:function(t){a=t,s=t.userId,$("#selectUpLoadPro").empty();for(var e=0;e<t.file.length;e++)$("#selectUpLoadPro").append("<option value="+t.file[e].id+" data-fileid="+e+" data-id="+t.file[e].id+">"+t.file[e].name+"</option>");""!=projectUP&&void 0!=projectUP?(n=projectUP,projectUP=$("#selectUpLoadPro option[data-id="+projectUP+"]").html()):(projectUP=p,n=""),$("#selectUpLoadPro").selectpicker({width:"100px",title:projectUP,size:10});for(var e in a.file)a.file[e].id==n&&$("li",$("#selectUpLoadPro").prev()).eq(e).addClass("selected");if(projectUP="",o=t.basePath,$("#onlineInitProject").empty(),0!=t.stream.length){$("#onlineInitProject").append('<option value="'+Dynamic.upload_skipStep+'" data-fileid="" data-id="">'+Dynamic.upload_skipStep+"</option>");for(var e=0;e<t.stream.length;e++)$("#onlineInitProject").append("<option value="+t.stream[e].id+" data-fileid="+e+" data-id="+t.stream[e].id+">"+t.stream[e].name+"</option>")}else $("#onlineInitProject").append('<option value="'+Dynamic.upload_streamCreatProject+'" data-fileid="" data-id="">'+Dynamic.upload_streamCreatProject+"</option>")}}),$("#upLoadForm").delegate("#selectUpLoadPro","change",function(){var t=Number($("li.selected").attr("data-original-index"));l=$("#selectUpLoadPro option:eq("+t+")").attr("data-id")}),$.ajax({async:!0,type:"post",url:"/api/dosage.open?cmd=WEL:DATASIZE",success:function(t){var e=parseFloat(t.flaotUsedDataSize)/parseFloat(t.flaotTotalSize)*100;$("#totol_data_size").text(t.totalSize),$("#used_data_size").text(t.usedSize),$("#left_data_size").text(t.xSize),$("#used_per").text(e.toFixed(2)+"%"),parseFloat(t.flaotUsedDataSize)/parseFloat(t.flaotTotalSize)*100>100?($("#p_used").css("width","100%"),$("#p_used").attr("class","progress-bar progress-bar-danger")):$("#p_used").css("width",e+"%")},error:function(){console.log("请求失败")}}),$("body").delegate("#selectUpLoadPro","change",function(){var t=Number($("li.selected").attr("data-original-index"));$("#init_project_id").val($("#selectUpLoadPro option:eq("+t+")").attr("data-id")),n=$("#selectUpLoadPro option:eq("+t+")").attr("data-id")});var j=0;$("body #upLoadForm").delegate(":file","change",function(){var t=Dynamic.upload_upLoadFormtips1,e=Dynamic.upload_upLoadFormtips2,a=this.files[0];name=a.name,size=a.size,url=window.URL.createObjectURL(a),type=name.split(".").pop();for(var o=["txt","zip","tar","7z","gzip","xz","rar","json","csv","log","Z","bz2","xls","xlsx"],n=0,s=0;s<o.length;s++)o[s].indexOf(type)!=-1&&(n=1);if(1==n)$("#upload_data").removeAttr("onsubmit"),$(this).parent().append("<div class='fileList'></div>"),$(".fileList").append("<ul><li>"+Dynamic.upload_fileName+"："+name+"</br> "+Dynamic.upload_fileType+"：."+type+"</br> "+Dynamic.upload_fileSize+"："+size+" Bytes</li><a class='cancelFile'>"+Dynamic.upload_cancel+"</a></ul>"),j+=size,$("#info").html(j+" bytes"),j=0,$("#progressBox").css("display","block"),size>0&&(i=!0);else{swal({title:t,text:e,type:"error",confirmButtonClass:"btn-error",confirmButtonText:c,closeOnConfirm:!1});var l=$("#upLoadFile");l.after(l.clone().val("")),l.remove()}}),$(".upLoadA").delegate(".cancelFile","click",function(){$(".fileList").remove();var t=$("#upLoadFile");t.after(t.clone().val("")),t.remove(),i=!1}),$("#submitBtn").click(function(t){if(1!=i)return void swal({title:"",text:u,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1});t.preventDefault();var a=Ladda.create(this);swal({title:Dynamic.upload_upLoadtitle1,text:m,type:"info",html:!0,showConfirmButton:!1,closeOnConfirm:!1});var o={type:"POST",beforeSend:function(){a.start()},uploadProgress:function(t,e,o,n){a.setProgress(n/100)},url:"/upload?productname=campass&userid="+userID+"&projectid="+n+"&product_id="+roleType,success:function(t){console.log(t);var o=t;a.stop();var n=setInterval(function(){$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:VALIDAEXCESS",data:{capacity:t.capacity},success:function(t){console.log(t),0!=t&&(clearInterval(n),"10"===t.isExcessData?swal({title:f,text:_,type:"info",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:y,cancelButtonText:h,closeOnConfirm:!1},function(a){a?swal({title:f,text:Dynamic.upload_isExcessData2+t.excessPrice+Dynamic.upload_isExcessData3,type:"info",html:!0,showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:v,cancelButtonText:h,closeOnConfirm:!1},function(a){a?"1"==t.isExcessAmount?swal({title:x,text:g,type:"warning",html:!0,confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1},function(){$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:NOUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal.close()}})}):(swal({title:Dynamic.upload_upLoadtitle1,text:m,type:"info",html:!0,showConfirmButton:!1,closeOnConfirm:!1}),$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:CONFIRMUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal({title:B,text:"",html:!0,confirmButtonText:c,type:"success"},function(){location.href="#/manage"})}}),2!=roleType||($("#init_file_id").val(t.fileId),e=o.file_id)):$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:NOUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal.close()}})}):$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:NOUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal.close()}})}):"8"===t.isExcessData?$.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:CONFIRMUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal({title:Dynamic.upload_submitBtntips14,text:Dynamic.upload_isExcessData1,html:!0,confirmButtonText:Dynamic.upload_ok,type:"warning"},function(){swal.close(),location.href="#/manage"})}}):($.ajax({async:!0,type:"post",url:"/api/upload.open?cmd=WEL:CONFIRMUPLOAD",data:{file_id:o.file_id,filepath:o.ssh_path,host:o.ssh_host,project_id:o.project_id},success:function(t){swal({title:B,text:"",html:!0,confirmButtonText:c,type:"success"},function(){location.href="#/manage"})}}),2!=roleType||($("#init_file_id").val(t.fileId),e=o.file_id)))},error:function(){}})},1e3)},error:function(t,e,o){a.stop(),console.log(t),console.log(e),console.log(o)}};$("#upLoadForm").ajaxSubmit(o)}),$(".parseFormatTable").delegate(".formatSelect","change",function(){$("option",$(this)).not($("option:selected",$(this))).removeAttr("selected"),$("option",$(this)).not($("option:selected",$(this))).attr("data-select",0),$("option:selected",$(this)).attr("selected",!0),$("option:selected",$(this)).attr("data-select",1)});var B=(Dynamic.upload_saveonly,Dynamic.upload_saveexp,Dynamic.upload_submitBtntips14);$("body").delegate(".formatTable select","change",function(){var t=$(this)[0].selectedIndex;$("option",$(this)).attr("data-select",0),$("option:eq("+t+")",$(this)).attr("data-select",1)}),$("body").delegate(".scriptUpload","click",function(){$(".uploadCaptionTitle").html(d)}),$("body").delegate(".brUpload","click",function(){$(".uploadCaptionTitle").html(r)});var C=!1;$("#go_sumb2").attr("class","btn default disabled"),$("#new_name").blur(function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:VALIDATEPROJECTNAME",data:{name:$("#new_name").val()},success:function(t){"20007"===t.code&&""!==$("#new_name").val()?(C=!0,$("#go_sumb2").attr("class","btn btn-primary"),$("#new_name").parent().removeClass("has-error"),$("#new_name").next().text("")):"20000"===t.code&&(C=!1,$("#go_sumb2").attr("class","btn default disabled"),$("#new_name").parent().addClass("has-error"),$("#new_name").next().text(Dynamic.upload_proRepetition)),""==$("#new_name").val()&&(C=!1,$("#go_sumb2").attr("class","btn default disabled"),$("#new_name").parent().addClass("has-error"),$("#new_name").next().text(Dynamic.upload_proNameEmpty))},error:function(t){}})}),$("#newModal").on("hide.bs.modal",function(){$("#new_name").val(""),$("#new_des").val(""),$("#new_name").next().text(""),C=!1,$("#new_name").parent().removeClass("has-error"),$("#go_sumb2").attr("class","btn default disabled")}),$("#go_sumb2").click(function(){if(C){var t="",e="";t=""===$("#new_name").val()?Dynamic.manage_newP:$("#new_name").val(),e=""===$("#new_des").val()?Dynamic.manage_newD:$("#new_des").val();var o={projectName:$("#new_name").val(),projectDesc:$("#new_des").val()};$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:insertfile",data:o,success:function(t){$.ajax({url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:roleID},success:function(t){a=t;var e=Dynamic.upload_n_setupprojectsuc;$(".modal,.modal-backdrop").fadeOut(350),swal({title:e,confirmButtonText:c,type:"success"}),$("#selectUpLoadPro").empty();for(var o=0;o<t.all.length;o++)$("#selectUpLoadPro").append("<option value="+t.all[o].name+" data-fileid="+o+" data-id="+t.all[o].id+">"+t.all[o].name+"</option>");if($("#selectUpLoadPro").append('<option value="'+p+'" data-fileid="" data-id="">'+p+"</option>"),$("#selectUpLoadPro").selectpicker("refresh"),$("#onlineInitProject").empty(),0!=t.stream.length){$("#onlineInitProject").append('<option value="'+Dynamic.upload_skipStep+'" data-fileid="" data-id="">'+Dynamic.upload_skipStep+"</option>");for(var o=0;o<t.stream.length;o++)$("#onlineInitProject").append("<option value="+t.stream[o].id+" data-fileid="+o+" data-id="+t.stream[o].id+">"+t.stream[o].name+"</option>")}else $("#onlineInitProject").append('<option value="'+Dynamic.upload_streamCreatProject+'" data-fileid="" data-id="">'+Dynamic.upload_streamCreatProject+"</option>")}})},error:function(){swal({title:"操作失败",confirmButtonText:c,type:"error"})}})}}),$(".copyScript").click(function(){$("#config_file_out_path").select(),document.execCommand("Copy"),swal({title:"",text:Dynamic.upload_copySuccess,type:"info",confirmButtonClass:"btn-success",confirmButtonText:c,closeOnConfirm:!1})}),$("#customTag").keyup(function(t){t=t||window.event;var e=$(this).val();$.ajax({type:"post",url:"/api/project.open?cmd=WEL:IFNAMEEXIST",data:{tag:e},async:!0,cache:!0,success:function(t){if(e==t.name)return $("#customTag").val(""),void swal({title:"",text:D,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1})},error:function(){swal({title:"Session过期，请重新登录！",text:"",type:"info",confirmButtonText:c,closeOnConfirm:!1})}})}),$(".buildBtn").click(function(){var t=$("#logPath").val(),e=$("#logTypeSelect").val(),a=$("option:selected",$("#onlineInitProject")).attr("data-id");if(""==a)return void swal({title:"",text:upload_submitBtntips16,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1});if(""==t.trim())return void swal({title:"",text:w,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1});if("选择日志类型"==e.trim())return void swal({title:"",text:b,type:"warning",confirmButtonClass:"btn-danger",confirmButtonText:c,closeOnConfirm:!1});var o=Ladda.create(this);o.start(),$.ajax({async:!0,cache:!0,type:"get",dataType:"json",url:"/api/upload.open?cmd=WEL:GETCURLCOMMAND",data:{roleId:roleID,path:t,logType:e,projectIds:a},success:function(t){o.stop(),$("#config_file_out_path").val(t.pattern),$(".flowUploadStep:eq(0)").addClass("done"),$(".flowUploadStep:eq(1)").addClass("active"),$(".scriptUploadBox1").fadeOut(),setTimeout(function(){$(".scriptUploadBox2").fadeIn()},100),$(".scriptUploadFlow li:eq(1)").addClass("scriptUploadFlowActive")}})}),$(".nextPage").each(function(t){$(this).click(function(){$(".scriptUploadBox"+(t+2)).hide(),$(".scriptUploadBox"+(t+3)).show(),$(".flowUploadStep:eq("+(t+1)+")").addClass("done"),$(".flowUploadStep:eq("+(t+2)+")").addClass("active")})}),$(".prevPage").each(function(t){$(this).click(function(){$(".scriptUploadBox"+(t+2)).hide(),$(".scriptUploadBox"+(t+1)).show(),$(".flowUploadStep:eq("+t+")").removeClass("done"),$(".flowUploadStep:eq("+(t+1)+")").removeClass("active")})})}return{render:e}});