define(["text!/tpl/manage.html","icheck"],function(a){function t(){$(".page-content").html(a);var t,e=["",Dynamic.manage_type1,Dynamic.manage_type2],n=["","success","danger","warning"],s=["",Dynamic.manage_active,Dynamic.manage_processing,Dynamic.manage_inactive];changeLanguage("manage");var c,i,o,l,r=function(){c="<li><a href='javascript:;' class='to_ana'><i class='icon-bar-chart'></i> "+Dynamic.manage_analysis+" </a></li>",o="<li><a href='javascript:;' class='to_ana' style='color:#ccc;'><i class='icon-bar-chart' style='color:#ccc;'></i> "+Dynamic.manage_analysis+" </a></li>",i="<li><a href='javascript:;' class='run_pro'><i class='fa fa-play'></i> "+Dynamic.manage_startProject+" </a></li>",l="<li><a href='javascript:;' class='run_pro' style='color:#ccc;'><i class='fa fa-play' style='color:#ccc;'></i> "+Dynamic.manage_startProject+" </a></li>"},d=function(){c="",o="",i="",l=""};3==roleType?r():d(),$(window).resize(function(){$("#source_wrapper").width()<1120?$("#source_wrapper").css("overflow-x","scroll"):$("#source_wrapper").css("overflow-x","visible")});var p=function(){$.ajax({async:!0,type:"post",url:"/api/dosage.open?cmd=WEL:DATASIZE",success:function(a){var t=parseFloat(a.flaotUsedDataSize)/parseFloat(a.flaotTotalSize)*100;$("#totol_data_size").text(a.totalSize),$("#used_data_size").text(a.usedSize),$("#left_data_size").text(a.xSize),$("#used_per").text(t.toFixed(2)+"%"),parseFloat(a.flaotUsedDataSize)/parseFloat(a.flaotTotalSize)*100>100?($("#p_used").css("width","100%"),$("#p_used").attr("class","progress-bar progress-bar-danger")):$("#p_used").css("width",t+"%")},error:function(){console.log(Dynamic.strings_senderror)}})},m=function(){$.ajax({async:!0,type:"post",dataType:"json",url:"/api/project.open",data:{roleId:roleID},success:function(a){var r=0;$.each(a,function(a,t){r++;var o="<i class='shou_fang'></i>",l="",d="",p="",m="",u="";if(null==t.filename)o="";else{var _=t.fileid.split(",");1==_.length&&(o="");for(var f=t.filename.split(","),y=t.fileid.split(","),h=t.fileuptime.split(","),g=t.filedeadtime.split(","),v=t.filetype.split(","),D=t.filesize.split(","),b=0;b<f.length;b++)o+="<div class='fen fenn'>"+f[b]+"</div>",l+="<div class='fen' data-type="+e+">"+e[v[b]]+"</div>",d+="<div class='fen'>"+h[b]+"</div>",p+="<div class='fen'>"+g[b]+"</div>",m+="<div class='fen'>"+D[b]+"</div>",u+='<li><input type="checkBox" class="cell" data-id="'+y[b]+'"/>'+f[b]+"</li>"}var w=$("<tr data-id='"+t.id+"' data-file="+t.fileid+" class='tr_mid' data-ptn='0'><td class='table-checkbox sorting_disabled'><div class='fen'><input type='checkbox' class='sel'></div></td><td><span class='label label-"+n[t.status]+" status' data-status="+t.status+">"+s[t.status]+"</span></td><td class='p_buttonx'><div class='ccc' title='"+t.name+"'>"+t.name+"</div></td><td class='p_buttonx'><div class='ccc' title='"+t.description+"'>"+t.description+"</div></td><td>"+t.create_time+"</td><td><div class='btn-group'><button class='btn blue btn-outline dropdown-toggle control' type='button' data-toggle='dropdown' aria-expanded='false'> "+Dynamic.manage_control+" <i class='fa fa-angle-down'></i></button><ul class='dropdown-menu' role='menu'>"+c+"<li><a href='javascript:;' class='to_serch'><i class='icon-magnifier'></i> "+Dynamic.manage_search+" </a></li><li><a href='javascript:;' class='edit_proN'><i class='icon-note'></i> "+Dynamic.manage_rename+" </a></li><li><a href='javascript:;' class='edit_proD'><i class='icon-note'></i> "+Dynamic.manage_redes+" </a></li><li><a href='javascript:;' class='up_load'><i class='icon-cloud-upload'></i> "+Dynamic.manage_upload+" </a></li>"+i+"<li><a href='javascript:;' class='delete_pro'><i class='icon-trash'></i> "+Dynamic.manage_delProject+" </a></li><li><a href='javascript:;' class='delete_file'><i class='icon-trash'></i> "+Dynamic.manage_delData+" </a></li></ul></div><div class='modal' style='display: none; padding-right: 17px;'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close'></button><h4 class='modal-title'>"+Dynamic.manage_delData+"</h4></div><div class='modal-body'><ul>"+u+"</ul></div><div class='modal-footer'><button type='button' class='btn dark btn-outline cbtn'>"+Dynamic.manage_cancle+"</button><button type='button' class='btn red delete_f'>"+Dynamic.manage_delselected+"</button></div></div></div></div></td><td class='td1 td2'>"+o+"</td><td class='td1'>"+l+"</td><td class='td1'>"+d+"</td><td class='td1'>"+p+"</td><td class='td1'>"+m+"</td></tr>");$("tbody").append(w)}),$("#xxx").html(r),$.ajax({async:!0,type:"post",data:{roleId:roleID},dataType:"json",url:"/api/dosage.open",success:function(a){$.each(a,function(a,t){var n='<li><input type="checkBox" class="cell" data-id="'+t.ds_id+'"/>'+t.name+"</li>",s=$("<tr data-file="+t.ds_id+" class='noPro'><td></td><td></td><td><select class='selectpicker'></select></td><td></td><td></td><td><div class='btn-group'><button class='btn blue btn-outline dropdown-toggle control' type='button' data-toggle='dropdown' aria-expanded='false'> "+Dynamic.manage_control+" <i class='fa fa-angle-down'></i></button><ul class='dropdown-menu' role='menu'>"+o+"<li><a href='javascript:void(0);' class='to_serch' style='color:#ccc;'><i class='icon-magnifier' style='color:#ccc;'></i> "+Dynamic.manage_search+" </a></li><li><a href='javascript:void(0);' class='edit_proN' style='color:#ccc;'><i class='icon-note' style='color:#ccc;'></i> "+Dynamic.manage_rename+" </a></li><li><a href='javascript:void(0);' class='edit_proD' style='color:#ccc;'><i class='icon-note' style='color:#ccc;'></i> "+Dynamic.manage_redes+" </a></li><li><a href='javascript:void(0);' class='up_load' style='color:#ccc;'><i class='icon-cloud-upload' style='color:#ccc;'></i> "+Dynamic.manage_upload+" </a></li>"+l+"<li><a href='javascript:void(0);' class='delete_pro' style='color:#ccc;'><i class='icon-trash' style='color:#ccc;'></i> "+Dynamic.manage_delProject+" </a></li><li><a href='javascript:void(0);' class='delete_file'><i class='icon-trash'></i> "+Dynamic.manage_delData+" </a></li></ul></div><div class='modal' style='display: none; padding-right: 17px;'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close'></button><h4 class='modal-title'>"+Dynamic.manage_delData+"</h4></div><div class='modal-body'><ul>"+n+"</ul></div><div class='modal-footer'><button type='button' class='btn dark btn-outline cbtn'>"+Dynamic.manage_cancle+"</button><button type='button' class='btn red delete_f'>"+Dynamic.manage_delselected+"</button></div></div></div></div></td><td><div class='fen'>"+t.name+"</div></td><td><div class='fen' data-type="+t.data_type+">"+e[t.data_type]+"</td><td><div class='fen'>"+t.uptime+"</div></td><td><div class='fen'>"+t.deadtime+"</div></td><td><div class='fen'>"+t.filesizes+"</div></td></tr>");$("tbody").append(s)}),t=$("#source").DataTable({autoWidth:!1,info:!0,ordering:!1,searching:!0,lengthChange:!0,paging:!0,deferRender:!0,pageLength:10,language:Lang})}})},error:function(){console.log(Dynamic.strings_senderror)}})},u=function(){function a(){var a=$(this).parents("tr").attr("data-id");swal({title:Dynamic.manage_sl_makesurea,text:Dynamic.manage_sl_pa,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.manage_sl_run,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:STARTUPPROJECT",data:{pid:a},success:function(a){swal({title:Dynamic.manage_sl_runsucess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})}})})}function e(){projectID=$(this).parents("tr").attr("data-id"),skipSwiper=0,skipPage="PV",upDateProID(),location.href="#/analysis/pv"}function n(){projectUP=$(this).parents("tr").attr("data-id"),location.href="#/upload"}function s(){3==roleType?(projectID=$(this).parents("tr").attr("data-id"),upDateProID()):sprojectID=$(this).parents("tr").attr("data-id");var a=$(this).parents("tr").attr("data-file").split(",");dataID=a,location.href="#/search"}$("tbody").find(".selectpicker").selectpicker({width:"200%",title:Dynamic.search_select}),$('table input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_square-blue",increaseArea:"20%"});var c="",i="",o="",l="";$.ajax({async:!0,type:"get",dataType:"json",url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:roleID},success:function(a){$.each(a.all,function(a,t){i+="<option data-id='"+t.id+"' data-status='"+t.status+"'>"+t.name+"</option>"}),$.each(a.file,function(a,t){o+="<option data-id='"+t.id+"' data-status='"+t.status+"'>"+t.name+"</option>"}),$.each(a.stream,function(a,t){l+="<option data-id='"+t.id+"' data-status='"+t.status+"'>"+t.name+"</option>"}),$(".noPro").each(function(){var a=$(this).children("td:nth-of-type(8)").children("div").attr("data-type"),t=$(this).find(".selectpicker");c=1==a?o:l,t.html(c)}),$("tbody").find(".selectpicker").selectpicker("render"),$("tbody").find(".selectpicker").selectpicker("refresh")}}),$("input[type='search']").attr("class","form-control input-sm input-small input-inline");var r=$("tbody .sel").not("input[name='nopro']"),d=$(".allsel");d.on("ifChecked",function(){r.iCheck("check")}),d.on("ifUnchecked",function(){r.iCheck("uncheck")}),$(".tr_mid").each(function(){var a=$(this).find(".status").attr("data-status");3==a?($(this).find(".run_pro").attr("data-run","0"),$(this).find(".to_ana").attr("data-run","1"),$(this).find(".to_serch").attr("data-run","1"),$(this).find(".up_load").attr("data-run","0")):1==a?($(this).find(".run_pro").attr("data-run","1"),$(this).find(".to_ana").attr("data-run","0"),$(this).find(".to_serch").attr("data-run","0"),$(this).find(".up_load").attr("data-run","0")):2==a&&($(this).find(".run_pro").attr("data-run","1"),$(this).find(".to_ana").attr("data-run","1"),$(this).find(".to_serch").attr("data-run","1"),$(this).find(".up_load").attr("data-run","1")),"null"==$(this).attr("data-file")&&$(this).find(".run_pro").attr("data-run","1")}),$(".tr_mid .run_pro").bind("click",a),$(".tr_mid .to_ana").bind("click",e),$(".tr_mid .up_load").bind("click",n),$(".tr_mid .to_serch").bind("click",s),$(".tr_mid .run_pro[data-run='1']").css("color","#ccc").children().css("color","#ccc"),$(".tr_mid .run_pro[data-run='1']").unbind("click",a),$(".tr_mid .to_ana[data-run='1']").css("color","#ccc").children().css("color","#ccc"),$(".tr_mid .to_ana[data-run='1']").unbind("click",e),$(".tr_mid .to_serch[data-run='1']").css("color","#ccc").children().css("color","#ccc"),$(".tr_mid .to_serch[data-run='1']").unbind("click",s),$(".tr_mid .up_load[data-run='1']").css("color","#ccc").children().css("color","#ccc"),$(".tr_mid .up_load[data-run='1']").unbind("click",n)},_=function(){$("tbody").delegate(".tr_mid .edit_proN","click",function(a){var e=$(this).parents("tr").find(".ccc").eq(0).html(),n=$(this);swal({title:Dynamic.manage_sl_writepro,type:"input",showCancelButton:!0,confirmButtonText:Dynamic.manage_sl_apply,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,inputValue:e,showLoaderOnConfirm:!0},function(a){if(a===!1)return!1;if(""===a)return swal.showInputError(Dynamic.manage_sl_pleaseb),!1;var e=n.parents("tr").attr("data-id"),s=a,c=n.parents("tr").children("td").eq(3).children(".ccc").html(),i=[e,s,c];$.post("/api/project.open?cmd=WEL:update",{"updata[]":i},function(){swal({title:Dynamic.manage_sl_subsucess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})})})}),$("tbody").delegate(".tr_mid .edit_proD","click",function(a){var e=$(this),n=$(this).parents("tr").find(".ccc").eq(1).html();swal({title:Dynamic.manage_sl_writedes,type:"input",showCancelButton:!0,confirmButtonText:Dynamic.manage_sl_apply,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,inputValue:n,showLoaderOnConfirm:!0},function(a){if(a===!1)return!1;if(""===a)return swal.showInputError(Dynamic.manage_sl_pleaseb),!1;var n=e.parents("tr").attr("data-id"),s=e.parents("tr").children("td").eq(2).children(".ccc").html(),c=a,i=[n,s,c];$.post("/api/project.open?cmd=WEL:update",{"updata[]":i},function(){swal({title:Dynamic.manage_sl_subsucess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})})})}),$("tbody").on("ifChecked",".sel",function(){$(this).parents("tr").addClass("selected")}),$("tbody").on("ifUnchecked",".sel",function(){$(this).parents("tr").removeClass("selected")}),$("tbody").on("click","tr.tr_mid",function(){$(this).toggleClass("selected"),$(this).find(".sel").iCheck("toggle")});var a=!1;$("#go_sumb").attr("class","btn default disabled"),$("#new_name").blur(function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:VALIDATEPROJECTNAME",data:{name:$("#new_name").val()},success:function(t){"20007"===t.code?(a=!0,$("#go_sumb").attr("class","btn btn-primary"),$("#new_name").parent().removeClass("has-error"),$("#new_name").next().text("")):"20000"===t.code&&(a=!1,$("#go_sumb").attr("class","btn default disabled"),$("#new_name").parent().addClass("has-error"),$("#new_name").next().text(Dynamic.upload_proRepetition)),""!=="#new_name".val()&&(a=!1,$("#go_sumb2").attr("class","btn default disabled"),$("#new_name").parent().addClass("has-error"),$("#new_name").next().text(Dynamic.upload_proNameEmpty))},error:function(a){}})}),$("#newModal").on("hide.bs.modal",function(){$("#new_name").val(""),$("#new_des").val(""),$("#new_name").next().text(""),a=!1,$("#new_name").parent().removeClass("has-error"),$("#go_sumb").attr("class","btn default disabled")}),$("#go_sumb").on("click",function(){if(a){var e="",n="";e=""===$("#new_name").val()?Dynamic.manage_newP:$("#new_name").val(),n=""===$("#new_des").val()?Dynamic.manage_newD:$("#new_des").val();var s={projectName:e,projectDesc:n};$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:insertfile",data:s,success:function(a){swal({title:Dynamic.manage_sl_newsuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){$("#newModal").modal("hide"),t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_newfalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})}}),$("body").delegate(".tr_mid .delete_pro","click",function(){var a=($(this).parents("tr"),[]);a.push($(this).parents("tr").attr("data-id")),swal({title:Dynamic.manage_sl_makesureb,text:Dynamic.manage_sl_pb,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.manage_sl_suredel,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:DELETE",data:{ids:a},success:function(a){swal({title:Dynamic.manage_sl_delsuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_delfalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})})}),$("#delete_select").on("click",function(){if(0===$("table input[type='checkbox']:checked").length)return swal({title:Dynamic.manage_sl_pleasec,confirmButtonText:Dynamic.manage_sl_apply}),!1;var a=[];$("tr.selected").length;$("tr.selected").each(function(){a.push($(this).attr("data-id"))}),swal({title:Dynamic.manage_sl_makesureb,text:Dynamic.manage_sl_pb,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.manage_sl_suredel,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:DELETE",data:{ids:a},success:function(a){swal({title:Dynamic.manage_sl_delsuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_delfalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})})}),$("tbody").delegate(".delete_file","click",function(){$(this).parents(".btn-group").next(".modal").show()}),$("tbody").delegate(".close","click",function(){$(this).parents(".modal").hide()}),$("tbody").delegate(".cbtn","click",function(a){a.stopPropagation(),$(this).parents(".modal").hide()}),$("tbody").delegate(".delete_f","click",function(){if(0===$(this).parents("tr").find(".cell:checked").length)return swal({title:Dynamic.manage_sl_pleasec,confirmButtonText:Dynamic.manage_sl_apply}),!1;var a="",e=$(this).parents("tr").find(".status").attr("data-status");$(this).parents("tr").hasClass("tr_mid")&&(a=$(this).parents("tr").attr("data-id"));var n="";$(this).parents("tr").find(".cell:checked").each(function(){n+=$(this).attr("data-id")+","}),swal({title:Dynamic.manage_sl_makesurec,text:Dynamic.manage_sl_pc,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.manage_sl_suredel,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({async:!0,type:"post",url:"/api/dosage.open?cmd=WEL:DELETE",data:{fid:n,pid:a,status:e},success:function(a){swal({title:Dynamic.manage_sl_delsuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_delfalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})})}),$("tbody").delegate(".shou_fang","click",function(a){a.stopPropagation();var t=$(this).parents(".tr_mid").find(".td1");0==$(this).parents(".tr_mid").attr("data-ptn")?(t.children("div").show(),$(this).parents(".tr_mid").attr("data-ptn","1"),$(this).css("transform","rotate(180deg)")):(t.children("div").hide(),t.each(function(){$(this).children("div").eq(0).show()}),$(this).parents(".tr_mid").attr("data-ptn","0"),$(this).css("transform","rotate(0deg)"))}),$("tbody").delegate(".selectpicker","change",function(){var a=$(this).find("option:selected").attr("data-id"),e=$(this).find("option:selected").attr("data-status"),n=$(this).parents("tr").attr("data-file"),s=$(this).parents("tr").children("td:nth-of-type(8)").children().attr("data-type");1==e?swal({title:Dynamic.manage_sl_makesured,text:Dynamic.manage_sl_pd,type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:Dynamic.manage_sl_apply,cancelButtonText:Dynamic.manage_cancle,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(){$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:BINDINGPROJECT",data:{roleType:roleType,pid:a,fileid:n,file_type:s},success:function(a){swal({title:Dynamic.manage_sl_savasuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_savefalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})}):$.ajax({async:!0,type:"post",url:"/api/project.open?cmd=WEL:BINDINGPROJECT",data:{roleType:roleType,pid:a,fileid:n,file_type:s},success:function(a){swal({title:Dynamic.manage_sl_savasuccess,confirmButtonText:Dynamic.manage_sl_apply,type:"success"},function(){t.destroy(),$("tbody tr").remove(),m()})},error:function(){swal({title:Dynamic.manage_sl_savefalse,confirmButtonText:Dynamic.manage_sl_apply,type:"error"})}})}),$("#c_pdf").on("click",function(){window.location.href="/api/download.open?cmd=WEL:RESMGTDOWNLOADPDF"}),$("#c_csv").on("click",function(){window.location.href="/api/download.open?cmd=WEL:RESMGTDOWNLOADCSV&&os_type="+(isMac()?"mac":"")})};$("#source").on("draw.dt",function(){u(),$("#source_wrapper").width()<1120?$("#source_wrapper").css("overflow-x","scroll"):$("#source_wrapper").css("overflow-x","visible")}),p(),m(),_()}return{render:t}});