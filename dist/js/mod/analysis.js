function dataTableInit(a){var e=a.DataTable({autoWidth:!1,info:!0,ordering:!0,searching:!0,lengthChange:!0,paging:!0,scrollY:"360px",scrollX:!0,scrollCollapse:!1,deferRender:!0,language:Lang});return $("input",a.parents(".txtData")).addClass("form-control input-sm input-small input-inline"),addLoadEvent(function(){$(".urlTd").css("width",.65*a.parents(".countent").width())}),e}function checkDateType(a,e,t){var r=a,s=e,n="";if("year"==t){r=Number(r.substring(0,4)),s=Number(s.substring(0,4));var i=s-r;1==i&&r!=s&&(s+=1),n="?cmd=WEL:SELECTYEAR"}else if("month"==t){r=Number(r.substring(0,6)),s=Number(s.substring(0,6));var i=s-r;1==i&&r!=s&&(s+=1),n="?cmd=WEL:SELECTMONTH"}else if("daily"==t){r=Number(r.substring(0,8)),s=Number(s.substring(0,8));var i=s-r;1==i&&r!=s&&(s+=1),n="?cmd=WEL:SELECTDAILY"}else if("hour"==t){r=Number(r.substring(0,10)),s=Number(s.substring(0,10));var i=s-r;1==i&&r!=s&&(s+=1),n="?cmd=WEL:SELECTHOUR"}else"minute"==t&&(r=Number(r),s=Number(s),n="?cmd=WEL:SELECTMINUTE");return{startTime:r,endTime:s,datetypeUrl:n}}function getChartData(a){var a=a,e=a.chart,t=a.rpType,r=!0,s=a.mapType||mapType,n=(a.setLocalStorage||!1,a.smCharts);"false"===a.isSmallChartLoad&&(r=!1);var i=a.startTime,o=a.endTime;void 0!=xhr&&xhr.abort(),xhr=$.ajax({type:"get",url:a.url+"?cmd=WEL:SELECTHOUR",data:{date:"",startTime:timeZoneChange(i),endTime:timeZoneChange(o),rpType:t,project_id:a.projectID,country:"World"===s?"":s,timeZone:timeZone},async:!0,cache:!0,dataType:"json",success:function(a){var t=swiper.activeIndex;if("#/analysis/cvr"!==location.hash){if(1===e.length){var s=e[0];renderChart(a,s,t),r&&"自定义日期"!==localStorage.getItem("ANALYSIS_LABLE")&&"Custom Range"!==localStorage.getItem("ANALYSIS_LABLE")&&n.build()}}else pageNameCheck(a);loadGeneralInfo(a),indexToAnalysis&&1==indexToAnalysis&&(indexToAnalysis=!1,skipSwiper=0)},error:function(a,t,r){if("abort"!==t){console.error("Fail to get Data"),console.log(t),console.log(r),console.log(a);var s={dataList:[]},i=swiper.activeIndex;$.each(e,function(a,e){"0"===localStorage.getItem("LINK_STATUS")?(smChartST[i]="201604260000",smChartET[i]="201604270000"):(smChartST[i]=startTime,smChartET[i]=endTime),renderChart(s,e,i),function(a){setTimeout(function(){n.build()},50)}(i),"hbarplot"===e.opts.type?i++:i--})}}})}function renderChart(a,e,t){var a=a,e=e,r={},t=t,s="";if(t=0===t?t:t||swiper.activeIndex,"0"===localStorage.getItem("LINK_STATUS")?(smChartST[t]="201604260000",smChartET[t]="201604270000"):(smChartST[t]=startTime,smChartET[t]=endTime),e.resize(),"areaplot"===e.opts.type||"barplot"===e.opts.type||"scatterplot"===e.opts.type){var n=formatLineData(a,e);r=n.formatData,s=n.tpl}else if("lineSelection"===e.opts.type){var n=formatLineSelectData(a,e);r=n.formatData,s=n.tpl}else if("mapplot"===e.opts.type){var n=formatMapData(a,e);r=n.formatData,s=n.tpl}else if("hbarplot"===e.opts.type){var n=formatHBarData(a,e);r=n.formatData,s=n.tpl}else if("treeplot"===e.opts.type){var n=formatTreeData(a,e);r=n.formatData,s=n.tpl}else if("hbarSelection"===e.opts.type){var n=formatHBarSelectData(a,e);r=n.formatData,s=n.tpl}else if("barplotStack"===e.opts.type){var n=formatBarStackData(a,e);r=n.formatData,s=n.tpl}e.injectData(r),e.hideLoading(),"close"!==e.opts.toolboxType&&renderDatatable(s,t)}function renderDatatable(a,e){var e=e;e=0===e?e:e||swiper.activeIndex,dataTableObj[e]&&dataTableObj[e].destroy(),$(".table-"+e+" tbody tr").remove(),$(".table-"+e+" tbody").append(a),dataTableObj[e]=dataTableInit($(".table-"+e))}function getSerieName(a){var e="";return"CRAWLER"===pageName?"sNum"===a?e=Dynamic.analysis_crawler_crawlerNum:"fNum"===a?e=Dynamic.analysis_crawler_notCrawler:"2XX"===a?e=Dynamic.analysis_crawler_status1:"3XX"===a?e=Dynamic.analysis_crawler_status2:"45X"===a?e=Dynamic.analysis_crawler_status3:"ipList"===a&&(e=Dynamic.analysis_ViewIP):"PV"===pageName||"IP"===pageName?"pv"===a||"urlCount"===a?e=Dynamic.analysis_ViewNum:"ip"===a&&(e=Dynamic.analysis_IpNum):"TP"===pageName?"staytime"===a&&(e=Dynamic.analysis_Timeonpath):"REFERRER"===pageName?"indirectType"===a&&(e=Dynamic.analysis_ViewNum):"OS"===pageName||"BR"===pageName||"REQUEST"===pageName?"os"!==a&&"browser"!==a&&"requesttype"!==a||(e=Dynamic.analysis_ViewNum):"STATUS"===pageName?"status"===a?e=Dynamic.analysis_Frequency:"everyIpStatus"!==a&&"everyUrlStatus"!==a||(e=Dynamic.analysis_ViewNum):"fNum"===a||"ipNum"===a||"urlNum"===a?e=Dynamic.analysis_sql_attackNum:"2XX"===a?e=Dynamic.analysis_sql_attackStatus1:"3XX"===a?e=Dynamic.analysis_sql_attackStatus2:"45X"===a?e=Dynamic.analysis_sql_attackStatus3:"ipList"===a&&(e=Dynamic.analysis_ViewIP),e}function htmlEncode(a){return $("<span/>").text(a).html()}function htmlDecode(a){return $("<span/>").html(a).text()}function formatBarStackData(a,e){var t=a.dataList,r=[];if(t&&t.length>0){var s={xAxis:{name:"",data:t[0].data.map(function(a){return a.name})},yAxis:{},series:[]};if("barplotStack"===e.opts.type&&(s.yAxis.name=Dynamic.analysis_pageViewNum),$.each(t,function(a,e){var t=getSerieName(e.name);e.data.length>0?s.series.push({name:t,data:e.data.map(function(a){return a.value})}):(s.xAxis.data=["0"],s.series.push({name:t,data:[0]}))}),$.each(t[0].data,function(a,e){for(var s=[],n=0;n<t.length;n++)s.push(t[n].data[a].value);r.push({name:e.name,value:s})}),r&&r.length>0&&"close"!==e.opts.toolboxType){var n="";$.each(r,function(a,e){var t=e.value;sum=_.reduce(t,function(a,e){return a+e}),percent=_.map(t,function(a){return 0===sum&&(sum=1),Math.round(a/sum*1e4)/100}),n+=3===swiper.activeIndex?"<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'>"+e.name+"</td><td nowrap='nowrap'>"+t[0]+"</td><td nowrap='nowrap'>"+percent[0]+"</td><td nowrap='nowrap'>"+t[1]+"</td><td nowrap='nowrap'>"+percent[1]+"</td><td nowrap='nowrap'>"+t[2]+"</td><td nowrap='nowrap'>"+percent[2]+"</td></tr>":"<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'>"+e.name+"</td><td nowrap='nowrap'>"+sum+"</td><td nowrap='nowrap'>"+t[1]+"</td><td nowrap='nowrap'>"+percent[1]+"</td><td nowrap='nowrap'>"+t[0]+"</td><td nowrap='nowrap'>"+percent[0]+"</td></tr>"})}}return{formatData:s,tpl:n}}function formatHBarData(a,e){var t=a.dataList;if(!(t&&t.length>0))return{formatData:{},tpl:""};var r={xAxis:{name:Dynamic.analysis_ViewNum},yAxis:{name:Dynamic.analysis_viewRanking,data:t[0].data.map(function(a){return a.name&&"others"===a.name.trim()&&(a.name=Dynamic.analysis_br_others),htmlEncode(a.name)})},series:[]};$.each(t,function(a,e){var t=getSerieName(e.name);"staytime"===e.name&&(r.xAxis.name=Dynamic.analysis_Timeonpath),"DATA"===pageName&&"urlCount"===e.name&&(r.xAxis.name=Dynamic.analysis_DataTraffic,r.yAxis.name=Dynamic.analysis_dataRanking,r.tooltip=e.data.map(function(a){return a.byteNum+a.unit})),r.series.push({name:t,data:e.data.map(function(a){return a.value})})});var s="";return $.each(r.series[0].data,function(a,e){s+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+r.yAxis.data[a]+"</div></td><td nowrap='nowrap'>"+e+"</td></tr>"}),{formatData:r,tpl:s}}function formatLineData(a,e){var t=a.dataList;if(!(t&&t.length>0))return{formatData:{},tpl:""};var r={xAxis:{name:"",data:t[0].data.map(function(a){return a.name})},yAxis:{},series:[]};"STATUS"===pageName&&(r.xAxis.name=Dynamic.analysis_status),$.each(t,function(a,e){var t=getSerieName(e.name);"DATA"===pageName&&(r.tooltip=e.data.map(function(a){return a.byteNum+a.unit})),r.series.push({name:t,data:e.data.map(function(a){return a.value})})});var s="";return"IP"===pageName&&1===swiper.activeIndex?$.each(r.series[1].data,function(a,e){s+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+r.xAxis.data[a]+"</div></td><td nowrap='nowrap'>"+e+"</td></tr>"}):$.each(r.series[0].data,function(a,e){s+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+r.xAxis.data[a]+"</div></td><td nowrap='nowrap'>"+e+"</td></tr>"}),{formatData:r,tpl:s}}function formatLineSelectData(a,e){var t=a.dataList,r={xAxis:{name:"",data:[]},yAxis:{name:Dynamic.analysis_Frequency},series:[]},s=[],n=[];if($.each(t,function(a,e){s.push(e.data),n.push(e.name)}),r.xAxis.data=s[0].map(function(a){return a.name}),r.legend=n,$.each(s,function(a,e){r.series.push({name:n[a],data:e.map(function(a){return a.value})})}),s&&s.length>0){var i="";$.each(r.series[0].data,function(a,e){i+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+r.xAxis.data[a]+"</div></td><td nowrap='nowrap'>"+e+"</td></tr>"})}return{formatData:r,tpl:i}}function formatMapData(a,e){var a=a.dataList,t=location.hash,r={};"#/analysis/pv"==t?(r={legend:[Dynamic.analysis_ViewNum,Dynamic.analysis_UniqueIP,Dynamic.analysis_DataNum],series:[{name:Dynamic.analysis_ViewNum,data:[]},{name:Dynamic.analysis_UniqueIP,data:[]},{name:Dynamic.analysis_DataNum,data:[]}],tooltip:[]},a&&a[0]&&a[0].data&&(r.series[0].data=a[0].data),a&&a[1]&&a[1].data&&(r.series[1].data=a[1].data),a&&a[2]&&a[2].data&&$.each(a[2].data,function(a,e){r.series[2].data.push({name:e.name,value:e.value}),r.tooltip.push(e.byteNum+"("+e.unit+")")})):"#/analysis/ip"==t?(r={legend:[Dynamic.analysis_UniqueIP,Dynamic.analysis_ViewNum,Dynamic.analysis_DataNum],series:[{name:Dynamic.analysis_UniqueIP,data:[]},{name:Dynamic.analysis_ViewNum,data:[]},{name:Dynamic.analysis_DataNum,data:[]}],tooltip:[]},a&&a[0]&&a[0].data&&(r.series[1].data=a[0].data),a&&a[1]&&a[1].data&&(r.series[0].data=a[1].data),a&&a[2]&&a[2].data&&$.each(a[2].data,function(a,e){r.series[2].data.push({name:e.name,value:e.value}),r.tooltip.push(e.byteNum+"("+e.unit+")")})):"#/analysis/data"==t&&(r={legend:[Dynamic.analysis_DataNum,Dynamic.analysis_ViewNum,Dynamic.analysis_UniqueIP],series:[{name:Dynamic.analysis_DataNum,data:[]},{name:Dynamic.analysis_ViewNum,data:[]},{name:Dynamic.analysis_UniqueIP,data:[]}],tooltip:[]},a&&a[0]&&a[0].data&&(r.series[1].data=a[0].data),a&&a[1]&&a[1].data&&(r.series[2].data=a[1].data),a&&a[2]&&a[2].data&&$.each(a[2].data,function(a,e){r.series[0].data.push({name:e.name,value:e.value}),r.tooltip.push(e.byteNum+"("+e.unit+")")}));var s="";return $.each(r.series[0].data,function(a,e){s+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+e.name+"</div></td><td nowrap='nowrap'>"+e.value+"</td></tr>"}),{formatData:r,tpl:s}}function formatTreeData(a,e){var a=a.dataList;if(!(a&&a.length>0))return{formatData:{},tpl:""};var t=getSerieName(a[0].name),r={tooltip:t,series:[{data:[]}]};if("DATA"===pageName&&"ipCount"===a[0].name&&(r.tooltip=a[0].data.map(function(a){return a.byteNum+a.unit})),$.each(a[0].data,function(a,e){e.name&&"others"===e.name.trim()&&(e.name=Dynamic.analysis_br_others),r.series[0].data.push({name:htmlEncode(e.name),value:e.value})}),a&&a.length>0){var s="";$.each(r.series[0].data,function(a,e){s+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+e.name+"</div></td><td nowrap='nowrap'>"+e.value+"</td></tr>"})}return{formatData:r,tpl:s}}function formatHBarSelectData(a,e){var t=a.dataList,r=[],s=[];$.each(t,function(a,e){r.push(e.data),s.push(e.name)});var n={xAxis:{name:Dynamic.analysis_Frequency},yAxis:{name:Dynamic.analysis_status_RankingURL,data:[]},legend:s,series:[]};if($.each(r,function(a,e){3===swiper.activeIndex&&(n.yAxis.name=Dynamic.analysis_status_RankingIP),n.yAxis.data.push(e.map(function(a){return a.name})),n.series.push({name:s[a],data:e.map(function(a){return a.value})})}),r&&r.length>0){var i="";$.each(n.series[0].data,function(a,e){i+="<tr><td nowrap='nowrap'>"+(a+1)+"</td><td nowrap='nowrap'><div class='urlTd' style='width:"+.65*$(".txtData>.countent").width()+"px;''>"+n.yAxis.data[0][a]+"</div></td><td nowrap='nowrap'>"+e+"</td></tr>"})}return{formatData:n,tpl:i}}function loadGeneralInfo(a){var e=location.hash,a=a;"#/analysis/pv"===e?pvRefresh(a):"#/analysis/tp"===e?tpRefresh(a):"#/analysis/rf"===e?rfRefresh(a):"#/analysis/ip"===e?ipRefresh(a):"#/analysis/os"===e?osRefresh(a):"#/analysis/br"===e?brRefresh(a):"#/analysis/status"===e?statusRefresh(a):"#/analysis/data"===e?dataRefresh(a):"#/analysis/request"===e?requestRefresh(a):"#/analysis/crawler"===e?crawlerRefresh(a):"#/analysis/sqlinjection"===e?injectionRefresh(a):"#/analysis/fileinclusion"===e?fileinclusionRefresh(a):"#/analysis/xss"===e&&xssRefresh(a),$(".counterSpan").counterUp({delay:10,time:300})}function showLoading(){"undefined"!=typeof funnelChart&&funnelChart.showLoading(loadingObj),"undefined"!=typeof lineChart&&lineChart.showLoading(loadingObj)}function hideLoading(){"undefined"!=typeof funnelChart&&funnelChart.hideLoading()}function pageNameCheck(a){if("CVR"==pageName){if($(".cvrBox_line3").css("display","none"),showLoading(),cvrMoreData=a,a.length>0){cvrUrlData=a;var e=[],t=[],r=[];$(".cvrBox_line2").css("display","none"),$(".cvrBox_line4").css("display","block"),$(".echarts_funnel").css({height:"100%"}),$(".echarts_more").css({height:"0%"}),funnelChart.resize(),$(".echarts_more").empty();for(var s=0;s<a.length;s++)t.push(a[s].url),e.push(a[s].desc),r.push(a[s].pvCount);if(document.getElementsByClassName("echarts_funnel")[0]){for(var n=[],i=[],s=0;s<e.length;s++){var o={};if(0!=r[s-1]){o.value=r[s];toDecimal2(ForDight(100*r[s]/r[s-1],4));o.name=e[s]}else{o.value="∞";o.name=e[s]}0!=s&&i.push(ForDight(r[s]/r[s-1],4)),n.push(o)}for(var p=i[0],l=1;l<i.length;l++)p=0==p||0==i[l]?0:i[l]*p;$(".cvrCount").html(toDecimal2(ForDight(100*a[a.length-1].pvCount/a[0].pvCount,2))+"%"),op01Funnel(n)}}hideLoading()}}function rpTypeCheck(){"PV"==pageName?0==swiper.activeIndex?rpType="areaplot":1==swiper.activeIndex?rpType="mapplot":2==swiper.activeIndex?rpType="hbarplot":3==swiper.activeIndex&&(rpType="treemap"):"IP"==pageName?0==swiper.activeIndex?rpType="areaplot":1==swiper.activeIndex?rpType="mapplot":2==swiper.activeIndex?rpType="hbarplot":3==swiper.activeIndex&&(rpType="treemap"):"DATA"==pageName?0==swiper.activeIndex?rpType="areaplot":1==swiper.activeIndex?rpType="mapplot":2==swiper.activeIndex?rpType="hbarplot":3==swiper.activeIndex&&(rpType="treemap"):"STATUS"==pageName?0==swiper.activeIndex?rpType="statusBar1":1==swiper.activeIndex?rpType="statusBar2":2==swiper.activeIndex?rpType="statusVbar1":3==swiper.activeIndex&&(rpType="statusVbar2"):"BR"==pageName||"OS"==pageName||"REQUEST"==pageName||"REFERRER"==pageName||"TP"==pageName?rpType="hbarplot":"CRAWLER"!=pageName&&"INJECTION"!=pageName&&"LOOPHOLE"!=pageName&&"SCRIPT"!=pageName||(0==swiper.activeIndex?rpType="fBar":1==swiper.activeIndex?rpType="ipBar":2==swiper.activeIndex?rpType="urlBar":3==swiper.activeIndex&&(rpType="statusBar"))}function calculateTime(a,e){var a=a,e=e,t=a.slice(0,4)+"-"+a.slice(4,6)+"-"+a.slice(6,8)+" "+a.slice(8,10)+":"+a.slice(10,12);return"year"===interval?a.slice(0,4)-e+a.slice(4):"oneMonth"===interval?moment(t).add(-e,"month").format("YYYYMMDDHHmm"):"week"===interval?moment(t).add(-7*e,"day").format("YYYYMMDDHHmm"):"day"===interval?moment(t).add(-e,"day").format("YYYYMMDDHHmm"):void 0}function formatTime(a,e){var a=a,e=e;return"year"===e?a.slice(0,4):"oneMonth"===e?a.slice(0,4)+"-"+a.slice(4,6):"week"===e?a.slice(0,4)+"-"+a.slice(4,6)+"-"+a.slice(6,8):"day"===e?a.slice(0,4)+"-"+a.slice(4,6)+"-"+a.slice(6,8):void 0}function buildSmChart(){var a=swiper.activeIndex,e=$(".smCharts-"+a);e.empty(),getSmChartData(5,0)}function getSmChartData(a,e){for(var t=[],r=[],s=0,e=e,a=a,n=5;n>=0;n--)t[s]=calculateTime(startTime,n),r[s]=calculateTime(endTime,n),s++;rpTypeCheck();var i=t[e],o=r[e],p=projectID,l=mapType;return!(a<0)&&void $.ajax({type:"get",url:btnUrl+"?cmd=WEL:SELECTHOUR",data:{date:"",startTime:timeZoneChange(i),endTime:timeZoneChange(o),rpType:rpType,project_id:p,country:"World"===l?"":l,timeZone:timeZone},async:!0,cache:!0,dataType:"json",success:function(t){console.log(e),console.log(t),getSmChartImg({cStartTime:i,cEndTime:o,data:t.dataList,idx:e}),e++,a--,getSmChartData(a,e)}})}function getSmChartImg(a){var e,t=swiper.activeIndex,r=$(".smCharts-"+t),s=a.cStartTime,n=a.cEndTime,i=a.idx,o=a.data;r.append('<li class="smChartsImg noPad col-md-2 col-xs-2 smChartsImg'+i+'"></li>');var p=[{time:s,data:o[0].data}];"CRAWLER"===pageName&&0===t||"CRAWLER"===pageName&&3===t?$.each(o,function(a,e){0===a?p[0].data=e.data:$.each(e.data,function(e,t){p[0].data[e]["value"+a]=t.value})}):"DATA"===pageName&&(p[0].data=[],$.each(o[0].data,function(a,e){p[0].data.push({name:e.name,value:e.value})}));var l=pageName;if(e="BR"==l||"OS"==l||"TP"==l?r.prev().prev().attr("class").split(" ").pop():r.prev().attr("class").split(" ").pop(),"CRAWLER"===l&&0===t&&(l="pv_crawler"),"mapplot"===e){var m=chartObj[1][0].opts.mapType;"World"===m?e="globalmap":"China"===m&&(e="cnmap")}var c=e;"CRAWLER"!==pageName&&"INJECTION"!==pageName&&"LOOPHOLE"!==pageName&&"SCRIPT"!==pageName||(1===t?c="byip":2===t?c="byurl":3===t&&(c="bystatus"));$.ajax({type:"get",url:"/api/analysis.open?cmd=WEL:PLOTDRAW",data:{hostIp:"60.205.152.23",filePath:"/data/www/NailFIG/"+userID+"/"+projectID+"/"+pageName+"/"+c+"/"+interval,plotType:e,plotName:l.toLowerCase(),dataJson:JSON.stringify(p)},async:!1,cache:!0,dataType:"json",success:function(a){console.log(a);var e=interval,t=r.find(".smChartsImg"+i);"0"===localStorage.getItem("LINK_STATUS")&&(imgTime=parseInt(parseInt(20160426e4)/1e4),e="day");var o,p;if(a&&""!=a?(o="http://60.205.152.23:8000"+a,p="smChartImg-h"):(o=Dynamic.analysis_errorimg,p="smChartImg-v"),"day"==e)t.append("<img class='"+p+"' src='"+o+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+formatTime(s,e)+"</span>");else if("week"==e){var l=s,m=n,c="<img class='"+p+"' src='"+o+"' alt='缩略图加载失败'></img><br /><span> "+Dynamic.analysis_form+" </span><span class='smChartsSt'>"+formatTime(l,e)+"</span></br><span> "+Dynamic.analysis_to+" </span><span class='smChartsEt'>"+formatTime(m,e)+"</span>";t.append(c)}else if("oneMonth"==e){var c="<img class='"+p+"' src='"+o+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+formatTime(s,e)+"</span>";t.append(c)}else if("year"==e){var c="<img class='"+p+"' src='"+o+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+formatTime(s,e)+"</span>";t.append(c)}}})}function smChartsBuild(a){var a=a;console.log(a);var e=$(".smCharts-"+a);if(e.length>0){e.empty();var t;if(t="BR"==pageName||"OS"==pageName||"TP"==pageName?e.prev().prev().attr("class").split(" ").pop():e.prev().attr("class").split(" ").pop(),"mapplot"===t){var r=chartObj[1][0].opts.mapType;"World"===r?t="global_mapplot":"China"===r&&(t="cn_mapplot")}var s=interval,n=parseInt(parseInt(startTime)/1e4);"0"===localStorage.getItem("LINK_STATUS")&&(n=parseInt(parseInt(20160426e4)/1e4),s="day"),$.ajax({async:!0,type:"post",dataType:"json",data:{date:n,project_id:projectID,pageName:pageName.toLowerCase(),figType:t,interval:s},url:"/api/analysis.open?cmd=WEL:GETADDRESS",success:function(a){var t="";$.each(a,function(a,e){var r,n;if(""!=e.url?(r=e.url,n="smChartImg-h"):(r=Dynamic.analysis_errorimg,n="smChartImg-v"),"day"==s)t+="<li class='smChartsImg noPad col-md-2 col-xs-2'><img class='"+n+"' src='"+r+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+e.time+"</span></li>";else if("week"==s){var i=e.time.split("|")[0],o=e.time.split("|")[1];t+="<li class='smChartsImg noPad col-md-2 col-xs-2'><img class='"+n+"' src='"+r+"' alt='缩略图加载失败'></img><br /><span> "+Dynamic.analysis_form+" </span><span class='smChartsSt'>"+i+"</span></br><span> "+Dynamic.analysis_to+" </span><span class='smChartsEt'>"+o+"</span></li>"}else"oneMonth"==s?t+="<li class='smChartsImg noPad col-md-2 col-xs-2'><img class='"+n+"' src='"+r+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+e.time+"</span></li>":"year"==s&&(t+="<li class='smChartsImg noPad col-md-2 col-xs-2'><img class='"+n+"' src='"+r+"' alt='缩略图加载失败'></img><br /><span class='smChartsSt' style='line-height:32px;'>"+e.time+"</span></li>")}),e.append(t)}})}}function analysis(a){function e(a){$.each(a,function(a,e){$.each(e,function(a,e){e&&e.resize()})})}var t=localStorage.getItem("ROLE_ID");projectID=localStorage.getItem("PROJECTID");localStorage.getItem("PROJECT_NAME");if($("#selectPro").selectpicker({width:"auto",size:10,title:Dynamic.analysis_emptyproject}),"0"!==localStorage.getItem("LINK_STATUS"))$.ajax({url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:t},success:function(a){var e,t="";if("200070"===a.code)swal({title:Dynamic.analysis_seesionExpired,text:"",type:"info",confirmButtonText:Danalysis_ok,closeOnConfirm:!1},function(){window.location.href="login.html"});else if(a.use&&0!=a.use.length){$("#selectPro").empty();for(var r=0;r<a.use.length;r++)projectID==a.use[r].id&&(e=a.use[r].name),t=t+"<option value="+a.use[r].name+" data-fileid="+r+" data-id="+a.use[r].id+">"+a.use[r].name+"</option>";$("#selectPro").empty(),$("#selectPro").append(t),$("#selectPro").selectpicker("render"),$("#selectPro").selectpicker({width:"auto",title:e,size:10}),$("#selectPro").selectpicker("refresh")}}});else{projectID="0",$("#selectPro").empty(),s="<option value="+Dynamic.analysis_emptyProSelect+" data-fileid='0' data-id='0'>"+Dynamic.analysis_emptyProSelect+"</option>",$("#selectPro").append(s),$(".analysisPro_choose").eq(0).selectpicker({width:"auto",title:Dynamic.analysis_emptyProSelect,size:10});var r=location.hash;if("#/analysis/crawler"===r||"#/analysis/sqlinjection"===r||"#/analysis/fileinclusion"===r||"#/analysis/xss"===r){$("#addChart").removeClass(),$("#reportrange").removeClass(),$("#analysisToSearchBtn").removeClass(),$("#addChart").addClass("btn default disabled"),$("#reportrange").addClass("btn default disabled"),$("#analysisToSearchBtn").addClass("btn default disabled");var s=$('<span style=\'display:inline-block;color:#678098;font-size:22px;font-weight:400;padding:1px 0 0px;\'>DEMO</span><button type="button" class="btn green btn-outline uppercase" id="setupBtn" style="margin:-10px 0px 0px 20px;height:26px;line-height:12px;font-size:12px;">'+Dynamic.analysis_atOnceSetup+"</button>");$("#analysisTitle").parent().after(s),$("#setupBtn").on("click",function(){$.ajax({type:"get",url:"/api/user.open?cmd=WEL:IMMEDIATELYOPEN",data:{menuCode:localStorage.getItem("PARENT_ID")},async:!0,success:function(a){"20000"===a.code?swal({title:Dynamic.analysis_setupMessage,text:"",type:"info",confirmButtonText:T,closeOnConfirm:!1}):swal({title:Dynamic.strings_senderror,text:"",type:"error",confirmButtonText:T,closeOnConfirm:!1})}})})}}"自定义日期"!=localStorage.getItem("ANALYSIS_LABLE")&&"Custom Range"!=localStorage.getItem("ANALYSIS_LABLE")||($(".smChartsImgBox").css("display","none"),"#/analysis/tp"==location.hash||"#/analysis/os"==location.hash||"#/analysis/br"==location.hash?$(".swiperB").addClass("swiperB_full_with_txt"):$(".swiperB").addClass("swiperB_full"));var n,i,o,p=function(){return 0==moment().weekday()?moment().subtract(7,"d").weekday(1).startOf("day"):moment().weekday(1).startOf("day")}(),l=function(){return 0==moment().weekday()?moment().subtract(7,"d").weekday(1).startOf("day").add(7,"d"):moment().weekday(1).startOf("day").add(7,"d")}(),m=function(){return""!=localStorage.getItem("ANALYSIS_START_TIME")&&null!=localStorage.getItem("ANALYSIS_START_TIME")?(startTime=moment(localStorage.getItem("ANALYSIS_START_TIME").toString()).format("YYYYMMDDHHmm"),"0"===localStorage.getItem("LINK_STATUS")?smChartST[0]="201604260000":smChartST[0]=startTime,moment(localStorage.getItem("ANALYSIS_START_TIME").toString())):("0"===localStorage.getItem("LINK_STATUS")?smChartST[0]="201604260000":smChartST[0]=moment().startOf("day").format("YYYYMMDDHHmm"),moment().startOf("day"))}(),c=function(){return""!=localStorage.getItem("ANALYSIS_END_TIME")&&null!=localStorage.getItem("ANALYSIS_END_TIME")?(endTime=moment(localStorage.getItem("ANALYSIS_END_TIME").toString()).format("YYYYMMDDHHmm"),"0"===localStorage.getItem("LINK_STATUS")?smChartET[0]="201604270000":smChartET[0]=endTime,moment(localStorage.getItem("ANALYSIS_END_TIME").toString())):("0"===localStorage.getItem("LINK_STATUS")?smChartET[0]="201604270000":smChartET[0]=moment().add(1,"d").startOf("day").format("YYYYMMDDHHmm"),moment().add(1,"d").startOf("day"))}();"zh"==localStorage.getItem("language")?(n={"今日":[moment().startOf("day"),moment().add(1,"d").startOf("day")],"昨日":[moment().subtract("days",1).startOf("day"),moment().startOf("day")],"本周":[p,l],"本月":[moment().startOf("month"),moment().add(1,"M").startOf("month")],"本年":[moment().startOf("year"),moment().add(1,"years").startOf("year")]},i=["今日","昨日","本周","本月","本年"],o={applyLabel:"确定",cancelLabel:"关闭",customRangeLabel:"自定义日期",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}):(n={Today:[moment().startOf("day"),moment().add(1,"d").startOf("day")],Yesterday:[moment().subtract("days",1).startOf("day"),moment().startOf("day")],"This Week":[p,l],"This Month":[moment().startOf("month"),moment().add(1,"M").startOf("month")],"This Year":[moment().startOf("year"),moment().add(1,"years").startOf("year")]},i=["Today","Yesterday","This Week","This Month","This Year","Custom Range"],o={customRangeLabel:"Custom Range"}),"0"!==localStorage.getItem("LINK_STATUS")?(""!=localStorage.getItem("ANALYSIS_DATE_HTML")&&null!=localStorage.getItem("ANALYSIS_DATE_HTML")?$("#reportrange>span").html(localStorage.getItem("ANALYSIS_DATE_HTML")):$("#reportrange>span").html(i[0]+"&nbsp;"+(new Date).Format("yyyy-MM-dd")+" -- "+(new Date).add("d",1).Format("yyyy-MM-dd")),$("#reportrange").daterangepicker({ranges:n,startDate:m,endDate:c,locale:o,timePicker:!0,timePicker24Hour:!0},function(a,e,t){"自定义日期"==t||"Custom Range"==t?$("#reportrange>span").html(a.format("YYYY-MM-DD HH:mm")+" - "+e.format("YYYY-MM-DD HH:mm")):$("#reportrange>span").html(t+"&nbsp;"+a.format("YYYY-MM-DD")+" - "+e.format("YYYY-MM-DD")),localStorage.setItem("ANALYSIS_DATE_HTML",$("#reportrange>span").html()),localStorage.setItem("ANALYSIS_START_TIME",new Date(a)),localStorage.setItem("ANALYSIS_END_TIME",new Date(e)),localStorage.setItem("ANALYSIS_LABLE",t),t==i[0]||t==i[1]?(interval="day",$(".smChartsImgBox").css("display","block"),$(".swiperB").removeClass("swiperB_full"),$(".swiperB").removeClass("swiperB_full_with_txt")):t==i[2]?(interval="week",$(".smChartsImgBox").css("display","block"),$(".swiperB").removeClass("swiperB_full"),$(".swiperB").removeClass("swiperB_full_with_txt")):t==i[3]?(interval="oneMonth",$(".smChartsImgBox").css("display","block"),$(".swiperB").removeClass("swiperB_full"),$(".swiperB").removeClass("swiperB_full_with_txt")):t==i[4]?(interval="year",$(".smChartsImgBox").css("display","block"),$(".swiperB").removeClass("swiperB_full"),$(".swiperB").removeClass("swiperB_full_with_txt")):"自定义日期"!=t&&"Custom Range"!=t||($(".smChartsImgBox").css("display","none"),"#/analysis/tp"==location.hash||"#/analysis/os"==location.hash||"#/analysis/br"==location.hash?$(".swiperB").addClass("swiperB_full_with_txt"):$(".swiperB").addClass("swiperB_full"));var r=a.format("YYYYMMDDHHmm"),s=e.format("YYYYMMDDHHmm");startTime=r,endTime=s,localStorage.setItem("ANALYSIS_INTERVAL",_interval),rpTypeCheck(),"#/analysis/cvr"!==location.hash?($.each(chartObj[swiper.activeIndex],function(a,e){e.showLoading()}),smChartArr[swiper.activeIndex].opts.startTime=startTime,smChartArr[swiper.activeIndex].opts.endTime=endTime,smChartArr[swiper.activeIndex].opts.interval=interval,getChartData({projectID:projectID,startTime:startTime,endTime:endTime,url:btnUrl,rpType:rpType,chart:chartObj[swiper.activeIndex],mapType:controlMapType,setLocalStorage:"hbarplot"===rpType||"treemap"===rpType,smCharts:smChartArr[swiper.activeIndex]})):getChartData({projectID:projectID,startTime:startTime,endTime:endTime,url:btnUrl,rpType:rpType})})):($("#reportrange>span").html("今日 2016-04-26 -- 2016-04-27"),$(".smChartsImgBox").css("display","block"),$(".swiperB").removeClass("swiperB_full")),$.ajax({type:"get",url:"/api/toppage.open?cmd=WEL:SELECTTOPINFO",async:!0,cache:!0,dataType:"json",success:function(a){""!=a.reportType?storageArr=a.reportType.split(","):storageArr=[]},error:function(){swal({title:"Session过期，请重新登录！",text:"",type:"info",confirmButtonText:T,closeOnConfirm:!1},function(){window.location.href="login.html"})}}),$("#dataListBtn").click(function(){0===moreDateMark?($(".txtData").css({"-webkit-transform":"translateY(-100%)","-moz-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)","-o-transform":"translateY(-100%)"}),$(".swiperImg").css({"-webkit-transform":"translateY(-100%)","-moz-transform":"translateY(-100%)","-ms-transform":"translateY(-100%)","-o-transform":"translateY(-100%)"}),moreDateMark=1,$(this).html(Dynamic.analysis_viewChart)):1==moreDateMark&&($(".swiperImg").css({"-webkit-transform":"translateY(0)"}),$(".swiperImg").css({"-moz-transform":"translateY(0)"}),$(".swiperImg").css({"-ms-transform":"translateY(0)"}),$(".swiperImg").css({"-o-transform":"translateY(0)"}),$(".txtData").css({"-webkit-transform":"translateY(0)"}),$(".txtData").css({"-moz-transform":"translateY(0)"}),$(".txtData").css({"-ms-transform":"translateY(0)"}),$(".txtData").css({"-o-transform":"translateY(0)"}),moreDateMark=0,$(this).html(Dynamic.analysis_viewData))}),$("#nav i").click(function(){$("#laydate_clear").hide()}),$(".analysisPageHead").delegate("select","change",function(){var a=Number($("li.selected").attr("data-original-index"));projectID=$("#selectPro option:eq("+a+")").attr("data-id"),"0"!==localStorage.getItem("LINK_STATUS")&&upDateProID(),skipSwiper=swiper.activeIndex,indexToAnalysis=!0,chartTime=[],$(".swiperImg").css({"-webkit-transform":"translateY(0)","-moz-transform":"translateY(0)","-ms-transform":"translateY(0)","-o-transform":"translateY(0)"}),$(".txtData").css({"-webkit-transform":"translateY(0)","-moz-transform":"translateY(0)","-ms-transform":"translateY(0)","-o-transform":"translateY(0)"}),$("#dataListBtn").html(Dynamic.analysis_viewData),"CVR"===pageName?cvrBtn():(rpTypeCheck(),$.each(chartObj[swiper.activeIndex],function(a,e){e.showLoading()}),getChartData({projectID:projectID,startTime:startTime,endTime:endTime,url:btnUrl,datetype:_interval,rpType:rpType,chart:chartObj[swiper.activeIndex],smCharts:smChartArr[swiper.activeIndex]}))}),$("#viewAttackSource").click(function(){var a=Ladda.create(this);a.start();var e={startTime:smChartST[swiper.activeIndex],endTime:smChartET[swiper.activeIndex],project_id:projectID,chartType:pageName,timeZone:timeZone,os_type:isMac()?"mac":"",chartTxt:[Dynamic.analysis_step,Dynamic.analysis_logTime,Dynamic.analysis_sourceIp,Dynamic.analysis_responseStatus]},t=document.createElement("form");t.action="/api/download.open?cmd=WEL:REPORTIPCSV",t.method="post",t.style.display="none";for(var r in e){var s=document.createElement("textarea");s.name=r,s.value=e[r],t.appendChild(s)}return document.body.appendChild(t),t.submit(),a.stop(),t});var d=Dynamic.analysis_addDashboard,h=Dynamic.analysis_addDashboardexp,u=Dynamic.analysis_addDashboardsuc,y=Dynamic.analysis_addDashboarddef,g=Dynamic.analysis_addDashboarderr1,f=Dynamic.analysis_addDashboarderr2,T=Dynamic.analysis_ok,w=Dynamic.analysis_cancel;$("#addChart").click(function(){var a=$(this);"#/analysis/cvr"!==location.hash&&0!=projectID&&"0"!==localStorage.getItem("LINK_STATUS")?swal({title:d,text:h,type:"info",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:T,cancelButtonText:w,closeOnConfirm:!1},function(){var e;a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_line")?e=pageName+"|line|"+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_map")?e=pageName+("World"===chartObj[1][0].opts.mapType?"|global_map|":"|cn_map|")+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).attr("class")?a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).attr("class").indexOf("echarts_Vbar")!=-1&&"STATUS"==pageName?a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).hasClass("echarts_Vbar1")?e=pageName+"|vBar1|"+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).hasClass("echarts_Vbar2")&&(e=pageName+"|vBar2|"+projectID):a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).attr("class").indexOf("echarts_Vbar")==-1||"CRAWLER"!==pageName&&"LOOPHOLE"!==pageName&&"INJECTION"!==pageName&&"SCRIPT"!==pageName?a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).attr("class").indexOf("echarts_Vbar")!=-1&&(e=pageName+"|vBar|"+projectID):a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).hasClass("echarts_Vbar1")?e=pageName+"|ipBar|"+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").children().eq(0).hasClass("echarts_Vbar2")&&(e=pageName+"|urlBar|"+projectID):a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_area")?e=pageName+"|area|"+projectID:"STATUS"==pageName?a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_bar1")?e=pageName+"|bar1|"+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_bar2")&&(e=pageName+"|bar2|"+projectID):"CRAWLER"!==pageName&&"LOOPHOLE"!==pageName&&"INJECTION"!==pageName&&"SCRIPT"!==pageName||(a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_bar1")?e=pageName+"|fBar|"+projectID:a.parents(".page-head").next().find(".swiper-slide-active .swiperB").hasClass("echarts_bar2")&&(e=pageName+"|statusBar|"+projectID)),
""!==e&&($.inArray(e,storageArr)==-1?(storageArr.push(e),void 0!=xhr&&xhr.abort(),xhr=$.ajax({type:"post",url:"/api/toppage.open",data:{storageArr:storageArr},async:!0,cache:!0,success:function(a){swal({title:u,confirmButtonText:T,type:"success"})},error:function(){swal({title:y,confirmButtonText:T,type:"error"})}})):swal({title:g,type:"error",confirmButtonText:T,closeOnConfirm:!1}))}):0==projectID&&"0"!==localStorage.getItem("LINK_STATUS")&&swal({title:f,type:"error",confirmButtonText:T,closeOnConfirm:!1})}),$("#analysisToSearchBtn").click(function(){"0"!==localStorage.getItem("LINK_STATUS")&&(location.hash="#/search")}),window.onresize=function(){"#/analysis/cvr"!=location.hash&&"#/search"!=location.hash&&"#/dashboard1"!=location.hash&&($("section").css("min-height",document.documentElement.clientHeight-240+"px"),chartObj&&chartObj.length>0&&e(chartObj),smChartObj&&smChartObj.length>0&&e(smChartObj))},$(".smChartsImgBox").delegate(".smChartsImg img","click",function(){if("img/error.png"!=$(this).attr("src")&&"img/error-en.png"!=$(this).attr("src")){var a=swiper.activeIndex;$(".echarts_vBar"+a).css({width:"100%"}),$(".echarts_lBar"+a).css({display:"none"}),chartObj[a][0].resize(),chartObj[a][0].showLoading(),$("li",$(this).parent().parent()).css("border","1px solid rgba(0,0,0,0)"),$(this).parent().css("border","1px solid #2E98FF");var e=$(this).attr("src").replace("/chart/NailFIG/","").replace(".png","").split("/"),t=e[4],r=moment(formatTime(e[5],t));if("0"===localStorage.getItem("LINK_STATUS")?smChartST[swiper.activeIndex]="201604260000":smChartST[swiper.activeIndex]=r.format("YYYYMMDDHHmm"),"week"===t?"0"===localStorage.getItem("LINK_STATUS")?smChartET[swiper.activeIndex]="201604270000":smChartET[swiper.activeIndex]=moment(r).add(7,"day").format("YYYYMMDDHHmm"):"0"===localStorage.getItem("LINK_STATUS")?smChartET[swiper.activeIndex]="201604270000":"oneMonth"===t?smChartET[swiper.activeIndex]=moment(r).add(1,"month").format("YYYYMMDDHHmm"):smChartET[swiper.activeIndex]=moment(r).add(1,t).format("YYYYMMDDHHmm"),"mapplot"===rpType){var s=chartObj[1][0].opts.mapType;"World"===s?rpType="global_mapplot":"China"===s&&(rpType="cn_mapplot")}void 0!=xhr&&xhr.abort(),xhr=$.ajax({type:"post",url:btnUrl+"?cmd=WEL:GETCHARINFO",data:{project_id:projectID,chartType:rpType,startTime:timeZoneChange(smChartST[swiper.activeIndex]),endTime:timeZoneChange(smChartET[swiper.activeIndex]),timeZone:timeZone},async:!0,success:function(a){loadGeneralInfo(a),renderChart(a,chartObj[swiper.activeIndex][0])},error:function(){}})}}),$(".region-select").delegate("a","click",function(){$(".region-select-group").eq(0).css({display:"none"}),$("button",$(".region-select-group").eq(1)).removeClass(),$("button",$(".region-select-group").eq(1)).addClass("btn default disabled");var e=$(this).attr("data-value");registMap(e),chartObj[swiper.activeIndex][0].myChart.dispose();var t=new a.Chart($(".echarts_map"),{type:"mapplot",title:Dynamic.homeCharts_title2});controlMapType=e,chartObj[1]=[t],t.showLoading(),chartObj[swiper.activeIndex][0].opts.mapType=e,$(".smChartsImgBox",$(this).parents(".swiperImg")).empty(),rpTypeCheck(),getChartData({projectID:projectID,startTime:startTime,endTime:endTime,url:btnUrl,datetype:_interval,rpType:rpType,chart:chartObj[swiper.activeIndex],mapType:e,timeZone:timeZone,smCharts:smChartArr[swiper.activeIndex]})})}var dataTableObj=[],chartTime=[],smChartObj=[],chartType,chartTxt=[];$("body").delegate(".printBtn","click",function(){var a=Ladda.create(this);a.start();var e={startTime:startTime,endTime:endTime,project_id:projectID,leftType:pageName,chartType:chartType,chartType:chartType,chartTxt:chartTxt,title:chartObj[swiper.activeIndex][0].opts.title,country:"World"===controlMapType?"":"China",timeZone:timeZone,os_type:isMac()?"mac":""};$.ajax({async:!0,type:"post",dataType:"json",data:e,url:"/api/analysis.open?cmd=WEL:PRINTREPORT",success:function(e){a.stop(),$("#printReportIframe").attr("src",e.pdf),setTimeout(function(){$("#printReportIframe")[0].contentWindow.print()},500)}})}),$("body").delegate(".pdfBtn","click",function(){var a=Ladda.create(this);a.start();var e={startTime:startTime,endTime:endTime,project_id:projectID,leftType:pageName,chartType:chartType,chartType:chartType,chartTxt:chartTxt,title:chartObj[swiper.activeIndex][0].opts.title,country:"World"===controlMapType?"":"China",timeZone:timeZone,os_type:isMac()?"mac":""},t=document.createElement("form");t.action="/api/download.open?cmd=WEL:REPORTPDF",t.method="post",t.style.display="none";for(var r in e){var s=document.createElement("textarea");s.name=r,s.value=e[r],t.appendChild(s)}return document.body.appendChild(t),t.submit(),a.stop(),t}),$("body").delegate(".csvBtn","click",function(){var a=Ladda.create(this);a.start();var e={startTime:startTime,endTime:endTime,project_id:projectID,leftType:pageName,chartType:chartType,chartType:chartType,chartTxt:chartTxt,title:chartObj[swiper.activeIndex][0].opts.title,country:"World"===controlMapType?"":"China",timeZone:timeZone,os_type:isMac()?"mac":""},t=document.createElement("form");t.action="/api/download.open?cmd=WEL:REPORTCSV",t.method="post",t.style.display="none";for(var r in e){var s=document.createElement("textarea");s.name=r,s.value=e[r],t.appendChild(s)}return document.body.appendChild(t),t.submit(),a.stop(),t});