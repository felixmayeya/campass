define(["text!/tpl/home.html","css!/css/home.css","homeCharts","jqueryUi"],function(t){function e(){function e(t,e,a){var r=t.split("|")[0];"PV"===r?(t.indexOf("global_map")!=-1?homeMapType="World":homeMapType="China",function(r){$.get("js/map/json/"+r.toLowerCase()+".json",function(i){echarts.registerMap(r,i),pvChartViewCheck(t,a,e)})}(homeMapType)):"IP"===r?(t.indexOf("global_map")!=-1?homeMapType="World":homeMapType="China",function(r){$.get("js/map/json/"+r.toLowerCase()+".json",function(i){echarts.registerMap(r,i),ipChartViewCheck(t,a,e)})}(homeMapType)):"DATA"===r?(t.indexOf("global_map")!=-1?homeMapType="World":homeMapType="China",function(r){$.get("js/map/json/"+r.toLowerCase()+".json",function(i){echarts.registerMap(r,i),dataChartViewCheck(t,a,e)})}(homeMapType)):"STATUS"===r?statusChartViewCheck(t,a,e):"BR"===r?brChartViewCheck(t,a,e):"OS"===r?osChartViewCheck(t,a,e):"REQUEST"===r?requestChartViewCheck(t,a,e):"TP"===r?tpChartViewCheck(t,a,e):"REFERRER"===r?rfChartViewCheck(t,a,e):"CRAWLER"===r?crawlerChartViewCheck(t,a,e):"INJECTION"===r?sqlChartViewCheck(t,a,e):"LOOPHOLE"===r?fiChartViewCheck(t,a,e):"SCRIPT"===r&&xssChartViewCheck(t,a,e)}$(".page-content").html(t),localStorage.getItem("OPTION_PACKAGE")&&"1"==localStorage.getItem("OPTION_PACKAGE")&&(window.location.href="#/package",localStorage.setItem("OPTION_PACKAGE",0)),localStorage.getItem("OPTION_MANAGE")&&"1"==localStorage.getItem("OPTION_MANAGE")&&(window.location.href="#/manage",localStorage.setItem("OPTION_MANAGE",0));var r=Dynamic.home_chooseTxt;$("#selectPro").selectpicker({width:"100px",title:r,size:10}),registMap(mapType),$.ajax({url:"/api/project.open?cmd=WEL:SELECTPROJECTNAME",data:{roleId:roleID},success:function(t){var e="";$("#selectPro").empty(),$("#selectPro").append('<option value="" data-fileid="1" data-id="" data-i18n="home_allProject">'+r+"</option>");for(var a=0;a<t.use.length;a++)e+="<option value="+t.use[a].name+" data-fileid="+(a+1)+" data-id="+t.use[a].id+">"+t.use[a].name+"</option>";$("#selectPro").append(e),$("#selectPro").selectpicker("render"),$("#selectPro").selectpicker("refresh"),$("#selectPro").selectpicker({width:"100px",title:r,size:10})}}),""!=localStorage.getItem("ANALYSIS_START_TIME")&&null!=localStorage.getItem("ANALYSIS_START_TIME")?(endTime=moment(localStorage.getItem("ANALYSIS_END_TIME").toString()).format("YYYYMMDDHHmm"),startTime=moment(localStorage.getItem("ANALYSIS_START_TIME").toString()).format("YYYYMMDDHHmm")):(startTime=moment().startOf("day").format("YYYYMMDDHHmm"),endTime=moment().add(1,"d").startOf("day").format("YYYYMMDDHHmm")),console.log("正在获取首页信息..."),$(".box2").show(),a=echarts.init(document.getElementById("loadbox")),a.showLoading({text:"loading",color:"#678098",textColor:"#678098",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0}),$.ajax({type:"get",url:"/api/toppage.open?cmd=WEL:GETTOPLIST",async:!0,cache:!0,data:{startTime:startTime,endTime:endTime,country:mapType,timeZone:8},dataType:"json",success:function(t){if(console.log("成功获取首页信息..."),a.hideLoading(),$(".box2").hide(),setTimeout(function(){$(".loadingBox").fadeOut()},1e3),""!=t.cList&&void 0!=t.cList)if(storageArr=t.cList,projectNameList=t.nameList,storageArr!=[]){$(".chartViewBox").empty();for(var r=0;r<storageArr.length;r++){var i=t.sList[r],o=(storageArr[r].split("|")[3],$("<li class='portlet portlet-sortable light col-lg-6 col-xs-12 col-sm-12'  style='padding:15px 15px 15px 15px;'><div class='chartViewBlock portlet light bordered'><div class='chartViewTitle portlet-title'><div class='caption'><i class='fa fa-folder-o font-blue-sharp'></i></div><div class='actions'><a class='btn btn-circle btn-icon-only btn-default shadeBox' href='javascript:;'><i class=' icon-action-redo'></i></a> <a class='btn btn-circle btn-icon-only btn-default delChartView' href='javascript:;'><i class='icon-trash'></i></a></div></div><div class='chartView portlet-body'><div class='chartBox viewNum"+r+"'></div></div></div></div></li>"));$(".chartViewBox").append(o),e(storageArr[r],r,i)}$("#sortable").sortable({revert:330,distance:50,forcePlaceholderSize:!0,items:"li",handle:".chartViewTitle",containment:"body",update:function(){if(0==indexProjectSelected){var t=new Array,e=new Array;$(".chartBox").each(function(){t.push(parseInt($(this).attr("class").replace("chartBox viewNum","")))});for(var a=0;a<t.length;a++)e.push(storageArr[t[a]]);$.ajax({type:"post",url:"/api/toppage.open",data:{storageArr:e},async:!0,cache:!0,success:function(t){},error:function(){alert("Error")}})}}}),$(".chartViewBox").append("<div class='col-lg-6 col-xs-12 col-sm-12' style='padding:15px;'>\t\t\t\t\t\t\t<div class='chartViewBlock bordered' style='border:2px dashed #c2cddc;padding-bottom: 25px;'>\t\t\t\t\t\t\t\t<div class='chartView' style='height:363px;top:0;'>\t\t\t\t\t\t\t\t\t<div class='addChartView'>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>"),$(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis/pv"})}else $(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis/pv"});else storageArr=[],$(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis/pv"})},error:function(){console.log("获取信息失败...")}}),$(".homePageHead").delegate(".homePro_choose","change",function(){var t=Number($("li.selected").attr("data-original-index")),e=$(".homePro_choose option:eq("+t+")").attr("data-id");""==e?(indexProjectSelected=!1,$(".titleProIdSpan").parents(".portlet").show()):(indexProjectSelected=!0,$(".titleProIdSpan").each(function(){$(this).attr("data-id")==e?$(this).parents(".portlet").show():$(this).parents(".portlet").hide()}))});var i,o,s,n=function(){return 0==moment().weekday()?moment().subtract(7,"d").weekday(1).startOf("day"):moment().weekday(1).startOf("day")}(),l=function(){return 0==moment().weekday()?moment().subtract(7,"d").weekday(1).startOf("day").add(7,"d"):moment().weekday(1).startOf("day").add(7,"d")}(),c=function(){return""!=localStorage.getItem("ANALYSIS_START_TIME")&&null!=localStorage.getItem("ANALYSIS_START_TIME")?(startTime=moment(localStorage.getItem("ANALYSIS_START_TIME").toString()).format("YYYYMMDDHHmm"),moment(localStorage.getItem("ANALYSIS_START_TIME").toString())):moment().startOf("day")}(),p=function(){return""!=localStorage.getItem("ANALYSIS_END_TIME")&&null!=localStorage.getItem("ANALYSIS_END_TIME")?(endTime=moment(localStorage.getItem("ANALYSIS_END_TIME").toString()).format("YYYYMMDDHHmm"),moment(localStorage.getItem("ANALYSIS_END_TIME").toString())):moment().add(1,"d").startOf("day")}();Dynamic.analysis_viewData;"zh"==localStorage.getItem("language")?(i={"今日":[moment().startOf("day"),moment().add(1,"d").startOf("day")],"昨日":[moment().subtract("days",1).startOf("day"),moment().startOf("day")],"本周":[n,l],"本月":[moment().startOf("month"),moment().add(1,"M").startOf("month")],"本年":[moment().startOf("year"),moment().add(1,"years").startOf("year")]},o=["今日","昨日","本周","本月","本年"],s={applyLabel:"确定",cancelLabel:"关闭",customRangeLabel:"自定义日期",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}):(i={Today:[moment().startOf("day"),moment().add(1,"d").startOf("day")],Yesterday:[moment().subtract("days",1).startOf("day"),moment().startOf("day")],"This Week":[n,l],"This Month":[moment().startOf("month"),moment().add(1,"M").startOf("month")],"This Year":[moment().startOf("year"),moment().add(1,"years").startOf("year")]},o=["Today","Yesterday","This Week","This Month","This Year"],s={customRangeLabel:"Custom Range"}),""!=localStorage.getItem("ANALYSIS_DATE_HTML")&&null!=localStorage.getItem("ANALYSIS_DATE_HTML")?$("#reportrange>span").html(localStorage.getItem("ANALYSIS_DATE_HTML")):$("#reportrange>span").html(o[0]+"&nbsp;"+(new Date).Format("yyyy-MM-dd")+" -- "+(new Date).add("d",1).Format("yyyy-MM-dd")),$("#reportrange").daterangepicker({ranges:i,startDate:c,endDate:p,locale:s,timePicker:!0,timePicker24Hour:!0},function(t,r,i){var s=t.format("YYYYMMDDHHmm"),n=r.format("YYYYMMDDHHmm");"自定义日期"==i||"Custom Range"==i?$("#reportrange>span").html(t.format("YYYY-MM-DD HH:mm")+" -- "+r.format("YYYY-MM-DD HH:mm")):$("#reportrange>span").html(i+"&nbsp;"+t.format("YYYY-MM-DD HH:mm")+" -- "+r.format("YYYY-MM-DD HH:mm")),localStorage.setItem("ANALYSIS_DATE_HTML",$("#reportrange>span").html()),localStorage.setItem("ANALYSIS_START_TIME",new Date(t)),localStorage.setItem("ANALYSIS_END_TIME",new Date(r)),localStorage.setItem("ANALYSIS_LABLE",i),i==o[0]||i==o[1]?interval="day":i==o[2]?interval="week":i==o[3]?interval="oneMonth":i==o[4]&&(interval="year"),void 0!=xhr&&xhr.abort(),xhr=$.ajax({type:"post",url:"/api/analysis.open?cmd=WEL:GETDATERYPE",data:{startTime:s,endTime:n},async:!0,cache:!0,dataType:"json",success:function(t){_interval=t.dateType}}),$(".box2").show(),a=echarts.init(document.getElementById("loadbox")),a.showLoading({text:"loading",color:"#678098",textColor:"#678098",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0}),$.ajax({type:"get",url:"/api/toppage.open?cmd=WEL:GETTOPLIST",async:!0,cache:!0,data:{startTime:s,endTime:n},dataType:"json",success:function(i){if(a.hideLoading(),$(".box2").hide(),""!=i.cList&&void 0!=i.cList)if(storageArr=i.cList,projectNameList=i.nameList,storageArr!=[]){$(".chartViewBox").empty();for(var o=0;o<storageArr.length;o++){var s=i.sList[o],n=(storageArr[o].split("|")[3],$("<li class='portlet portlet-sortable light col-lg-6 col-xs-12 col-sm-12'  style='padding:15px 15px 15px 15px;'><div class='chartViewBlock portlet light bordered'><div class='chartViewTitle portlet-title'><div class='caption'><i class='fa fa-folder-o font-blue-sharp'></i></div><div class='actions'><a class='btn btn-circle btn-icon-only btn-default shadeBox' href='javascript:;'><i class=' icon-action-redo'></i></a> <a class='btn btn-circle btn-icon-only btn-default delChartView' href='javascript:;'><i class='icon-trash'></i></a></div></div><div class='chartView portlet-body'><div class='chartBox viewNum"+o+"'></div></div></div></div></li>"));$(".chartViewBox").append(n),e(storageArr[o],o,s),$(".chartViewDateSpan").html(t.format("YYYY-MM-DD HH:mm")+" -- "+r.format("YYYY-MM-DD HH:mm"))}$("#sortable").sortable({revert:330,distance:50,forcePlaceholderSize:!0,items:"li",handle:".chartViewTitle",containment:"body",update:function(){if(0==indexProjectSelected){var t=new Array,e=new Array;$(".chartBox").each(function(){t.push(parseInt($(this).attr("class").replace("chartBox viewNum","")))});for(var a=0;a<t.length;a++)e.push(storageArr[t[a]]);$.ajax({type:"post",url:"/api/toppage.open",data:{storageArr:e},async:!0,cache:!0,success:function(t){storageArr=e},error:function(){console.log(error),alert("Error")}})}}}),$(".chartViewBox").append("<div class='col-lg-6 col-xs-12 col-sm-12' style='padding:15px;'>\t\t\t\t\t\t\t\t<div class='chartViewBlock bordered' style='border:2px dashed #c2cddc;padding-bottom: 25px;'>\t\t\t\t\t\t\t\t\t<div class='chartView' style='height:363px;top:0;'>\t\t\t\t\t\t\t\t\t\t<div class='addChartView'>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>"),$(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis"})}else $(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis"});else storageArr=[],$(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis"})},error:function(){swal({title:"获取信息失败，请重新登录！",text:"",type:"info",confirmButtonText:"确定",closeOnConfirm:!1},function(){window.location.href="login.html"})}})}),changeLanguage("home")}var a,r=Dynamic.home_delete,i=Dynamic.home_deletesuc,o=Dynamic.home_deletefaild,s=Dynamic.home_ok,n=Dynamic.home_cancel;return $("body").delegate(".shadeBox","click",function(){var t="";projectID=$(".caption .titleProIdSpan",$(this).parents(".chartViewTitle")).attr("data-id"),indexToAnalysis=!0;var e=parseInt($(this).parent().parent().parent().parent().index()),a=storageArr[e].split("|");skipPage=a[0];var r=a[1];"PV"==skipPage?("line"==r?skipSwiper=0:"global_map"==r||"cn_map"==r?("global_map"===r?homeSkipMapType="World":homeSkipMapType="China",skipSwiper=1):"vBar"==r?skipSwiper=2:"area"==r&&(skipSwiper=3),t="#/analysis/pv"):"IP"==skipPage?("line"==r?skipSwiper=0:"global_map"==r||"cn_map"==r?("global_map"===r?homeSkipMapType="World":homeSkipMapType="China",skipSwiper=1):"vBar"==r?skipSwiper=2:"area"==r&&(skipSwiper=3),t="#/analysis/ip"):"DATA"==skipPage?("line"==r?skipSwiper=0:"global_map"==r||"cn_map"==r?("global_map"===r?homeSkipMapType="World":homeSkipMapType="China",skipSwiper=1):"vBar"==r?skipSwiper=2:"area"==r&&(skipSwiper=3),t="#/analysis/data"):"STATUS"==skipPage?("bar1"==r?skipSwiper=0:"bar2"==r?skipSwiper=1:"vBar1"==r?skipSwiper=2:"vBar2"==r&&(skipSwiper=3),t="#/analysis/status"):"BR"==skipPage?("vBar"==r?skipSwiper=0:"area"==r&&(skipSwiper=1),t="#/analysis/br"):"OS"==skipPage?("vBar"==r?skipSwiper=0:"area"==r&&(skipSwiper=1),t="#/analysis/os"):"REQUEST"==skipPage?("vBar"==r?skipSwiper=0:"area"==r&&(skipSwiper=1),t="#/analysis/request"):"REFERRER"==skipPage?("vBar"==r?skipSwiper=0:"area"==r&&(skipSwiper=1),t="#/analysis/rf"):"TP"==skipPage?("vBar"==r?skipSwiper=0:"area"==r&&(skipSwiper=1),t="#/analysis/tp"):"CRAWLER"===skipPage?("fBar"==r?skipSwiper=0:"ipBar"==r?skipSwiper=1:"urlBar"==r?skipSwiper=2:"statusBar"==r&&(skipSwiper=3),t="#/analysis/crawler"):"INJECTION"===skipPage?("fBar"==r?skipSwiper=0:"ipBar"==r?skipSwiper=1:"urlBar"==r?skipSwiper=2:"statusBar"==r&&(skipSwiper=3),t="#/analysis/sqlinjection"):"LOOPHOLE"===skipPage?("fBar"==r?skipSwiper=0:"ipBar"==r?skipSwiper=1:"urlBar"==r?skipSwiper=2:"statusBar"==r&&(skipSwiper=3),t="#/analysis/fileinclusion"):"SCRIPT"===skipPage&&("fBar"==r?skipSwiper=0:"ipBar"==r?skipSwiper=1:"urlBar"==r?skipSwiper=2:"statusBar"==r&&(skipSwiper=3),t="#/analysis/xss"),localStorage.setItem("PROJECTID",projectID),$.ajax({type:"POST",url:"/api/toppage.open?cmd=WEL:UPDATEPROJECTID",data:{projectID:projectID},async:!0,cache:!0,dataType:"json",success:function(e){location.href=t}})}),$("body").delegate(".delChartView","click",function(){var t=$(this);swal({title:r,text:"",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:s,cancelButtonText:n,closeOnConfirm:!1},function(){var e=t.parent().parent().parent().parent().index();t.parent().parent().parent().parent().remove(),storageArr.splice(e,1),$.ajax({type:"post",url:"/api/toppage.open",data:{storageArr:storageArr},async:!0,cache:!0,success:function(t){swal({title:i,confirmButtonText:s,type:"success"}),0==storageArr.length&&($(".chartViewBox").html("<div class='col-lg-6 col-xs-12 col-sm-12' style='padding:15px;'>\t\t\t\t\t\t\t<div class='chartViewBlock bordered' style='border:2px dashed #c2cddc;padding-bottom: 25px;'>\t\t\t\t\t\t\t\t<div class='chartView' style='height:363px;top:0;'>\t\t\t\t\t\t\t\t\t<div class='addChartView'>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>"),$(".chartView:last").click(function(){skipPage="PV",skipSwiper=0,location.href="#/analysis"}))},error:function(){swal({title:o,confirmButtonText:s,type:"error"})}})})}),{render:e}});