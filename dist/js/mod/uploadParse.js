define(["text!/tpl/uploadParse.html","jqueryForm"],function(e){function t(){var t=!1;if($(".formatTable thead").empty(),$(".formatTable tbody").empty(),$(".parseLoading").css("display","block"),$("#parseSave").undelegate(),$("#saveFormat").undelegate(),$("#saveAndAnalysis").undelegate(),$(".page-content").html(e),changeLanguage("upload"),""!=localStorage.getItem("FILE_PATH_DATA")&&(console.log("local"),filePath=JSON.parse(localStorage.getItem("FILE_PATH_DATA")),localStorage.setItem("FILE_PATH_DATA","")),console.log(filePath),""!=filePath){var a=filePath.file_path;console.log(a),$.ajax({url:"/api/preResolution.open?cmd=WEL:SELECTPRERESOLUTIONBYTAG",async:!0,cache:!1,type:"post",data:{fileId:a},success:function(e){if(console.log(e),e.error||0==e)e.error&&0!=e&&swal({title:e.error,text:"",confirmButtonText:Dynamic.upload_ok,type:"error"},function(){closeThisMessage(filePath.id,userID),location.href="#/upload"});else{$(".parseLoading").css("display","none");for(var o=$("<tr id='selectTr'></tr>"),l=0;l<e.header.length;l++){for(var n=$("<th></th>"),s=$('<select class="pro_choose formatSelect" data-style="btn border-blue font-blue btn-default dropdown-toggle"></select>'),i=0;i<e.header.length;i++){var c=$("<option value="+e.header[i]+" data-select=0>"+e.header[i]+"</option>");c.val()==e.header[l]&&(c.attr("selected",!0),c.attr("data-select",1)),s.append(c)}n.append(s),o.append(n)}$(".formatTable thead").append(o);for(var l=0;l<e.body.length;l++){for(var r=$("<tr></tr>"),i=0;i<e.body[l].length;i++){var d=$("<td>"+e.body[l][i]+"</td>");r.append(d)}$(".formatTable tbody").append(r)}null!=e.streamTag?($(".parseFormatTable th select").attr("disabled",!0),$("#uploadTitle").text(Dynamic.upload_Streamingtxt1),$("#parseSave").show(),$("body").delegate("#parseSave","click",function(){swal({title:Dynamic.uploadParse_saveAnalysis,text:Dynamic.uploadParse_saveAnalysisexp,type:"info",showCancelButton:!0,closeOnConfirm:!1,confirmButtonClass:"btn-success",confirmButtonText:Dynamic.upload_confirm,cancelButtonText:Dynamic.upload_cancel},function(){swal({title:Dynamic.upload_saveAnalysistips,showConfirmButton:!1});for(var e=[],t=0;t<$(".resolvingBox option[data-select=1]").length;t++)e.push($(".resolvingBox option[data-select=1]").eq(t).val());console.log(e),$.ajax({async:!0,cache:!0,type:"post",url:"/api/preResolution.open?cmd=WEL:CONFIRMPRERESOLUTION",data:{header:e.toString(),fileId:a},success:function(e){selectFileFlag=!1,swal({title:"操作成功",text:"",confirmButtonText:"确定",type:"success"},function(){closeThisMessage(filePath.id,userID),localStorage.setItem("OPTION_MANAGE",1),location.href="#/index"})}})})})):($("#saveFormat").show(),$("#saveAndAnalysis").show(),$("body").delegate("#saveFormat","click",function(){swal({title:Dynamic.upload_save,text:Dynamic.upload_saveexp,type:"info",showCancelButton:!0,closeOnConfirm:!1,confirmButtonClass:"btn-success",confirmButtonText:Dynamic.upload_ok,cancelButtonText:Dynamic.upload_cancel},function(){swal({title:Dynamic.upload_saveAnalysistips,showConfirmButton:!1});for(var t=[],a=0;a<$(".resolvingBox option[data-select=1]").length;a++)t.push($(".resolvingBox option[data-select=1]").eq(a).val());$.ajax({async:!0,cache:!0,type:"post",url:"/api/upload.open?cmd=WEL:SAVENOTCOMPIRE",data:{projectId:e.projectId,fileId:e.fileId,header:t.toString()},success:function(e){selectFileFlag=!0,swal({title:Dynamic.upload_submitBtntips14,text:"",confirmButtonText:Dynamic.upload_ok,type:"success"},function(){localStorage.setItem("OPTION_MANAGE",1),location.href="#/index",closeThisMessage(filePath.id,userID)})},error:function(e,t,a){alert(e.status),alert(e.readyState),alert(t)}})})}),$("body").delegate("#saveAndAnalysis","click",function(){t===!1&&swal({title:Dynamic.upload_saveAnalysis,text:Dynamic.upload_saveAnalysisexp,type:"info",showCancelButton:!0,closeOnConfirm:!1,confirmButtonClass:"btn-success",confirmButtonText:Dynamic.upload_confirm,cancelButtonText:Dynamic.upload_cancel},function(){swal({title:Dynamic.upload_saveAnalysistips,showConfirmButton:!1});for(var t=[],a=0;a<$(".resolvingBox option[data-select=1]").length;a++)t.push($(".resolvingBox option[data-select=1]").eq(a).val());$.ajax({async:!0,cache:!0,type:"post",url:"/api/upload.open?cmd=WEL:SUBMITFILECOMPIE",data:{header:t.toString(),fileId:e.fileId,projectId:e.projectId},success:function(e){selectFileFlag=!1,swal({title:Dynamic.upload_submitBtntips14,text:"",confirmButtonText:Dynamic.upload_ok,type:"success"},function(){closeThisMessage(filePath.id,userID),localStorage.setItem("OPTION_MANAGE",1),location.href="#/index"})}})})}))}}}),$(".parseFormatTable").delegate(".formatSelect","change",function(){$("option",$(this)).not($("option:selected",$(this))).removeAttr("selected"),$("option",$(this)).not($("option:selected",$(this))).attr("data-select",0),$("option:selected",$(this)).attr("selected",!0),$("option:selected",$(this)).attr("data-select",1)})}else location.href="/index.html"}return{render:t}});