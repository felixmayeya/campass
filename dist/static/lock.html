<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
	<meta charset="utf-8" />
	<title>OPEN01 | 开数科技</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<meta content="Preview page of Metronic Admin Theme #4 for " name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
	<!-- END GLOBAL MANDATORY STYLES -->
	<!-- BEGIN THEME GLOBAL STYLES -->
	<link href="../assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
	<link href="../assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/bootstrap-sweetalert/sweetalert.css" rel="stylesheet" type="text/css">
	<!-- END THEME GLOBAL STYLES -->
	<!-- BEGIN PAGE LEVEL STYLES -->
	<link href="../assets/pages/css/lock.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/layouts/layout4/css/custom.min.css" rel="stylesheet" type="text/css" />
	<!-- END PAGE LEVEL STYLES -->
	<!-- BEGIN THEME LAYOUT STYLES -->
	<!-- END THEME LAYOUT STYLES -->
	<link rel="shortcut icon" href="favicon.ico" />
	<style>
		i{
			font-style:normal;
		}
		.page-footer-custom>p>a{
		    font-size: 12px;
			color: #a9b5be;
		}
	</style>
	</head>
<!-- END HEAD -->

<body class="">
	<div class="page-lock">
		<div class="page-logo">
			<a class="brand" href="/home.html">
				<img src="../img/campass.png" alt="logo" class="logo-default" style="width:160px;"> </a>
		</div>
		<div class="page-body">
			<div class="lock-head" data-i18n="lock_lock"> 暂时离开 </div>
			<div class="lock-body">
				<div class="pull-left lock-avatar-block" style="width:170px">
					<img src="" class="lock-avatar"> </div>
				<form class="lock-form pull-left" method="post" style="width:200px">
					<h4></h4>
					<div class="form-group">
						<input class="form-control placeholder-no-fix" data-place="lock_password" id="z_password" type="password" autocomplete="off" placeholder="密码" name="password" /> </div>
					<div class="form-actions">
						<a href="javascript:void(0);" class="btn red uppercase goBack" style="width:200px" data-i18n="lock_back">返回</a>
					</div>
				</form>
			</div>
			<div class="lock-bottom">
				<a href="/login.html" id="not"><i data-i18n="lock_not">不是</i>&nbsp;<b></b>&nbsp;?</a>
			</div>
		</div>
		<div class="page-footer-custom">
			 <p>
				<i data-i18n="string_copy">2016-2017 &copy;</i>&nbsp;<a
					href="http://www.open01.com" target="_blank"
					data-i18n="strin_company">北京开数科技有限公司</a>&nbsp;<i
					data-i18n="string_copyright">版权所有&nbsp;京ICP备16025114号</i>
			</p>
			<p>
				<a href="agreement.html" target="_blank"
					data-i18n="string_agreementQ">服务协议</a>&nbsp;|&nbsp;<a
					href="license.html" target="_blank"
					data-i18n="string_licenseQ">软件许可</a>&nbsp;|&nbsp;<a
					href="privacy.html" target="_blank" data-i18n="string_policyQ">隐私条款</a>
			</p>
		</div>
	</div>
	<!--[if lt IE 9]>
<script src="../../assets/global/plugins/respond.min.js"></script>
<script src="../../assets/global/plugins/excanvas.min.js"></script>
<script src="../../assets/global/plugins/ie8.fix.min.js"></script>
<![endif]-->
	<script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
	<script src="../js/lib/jquery.i18n.properties.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
	<script src="../assets/pages/scripts/lock.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/bootstrap-sweetalert/sweetalert.min.js" type="text/javascript"></script>
	<script>
		var Lang = localStorage.getItem("language");
		var Dynamic;
		var dynamic_zh={
				strings_wrongname:"该用户名不存在，请注册!",
				strings_wrongpassword:"密码错误，请重新输入！",
				strings_writename:"获取用户信息失败",
				strings_writepassword:"请输入密码",
				strings_senderror:"请求失败",
				strings_ok:"确定",
		};
		var dynamic_en={
				strings_wrongname:"The username does not exist",
				strings_wrongpassword:"Password error! please watch for to distinguish analyse the size to write",
				strings_writename:"Failed to get user information",
				strings_writepassword:"Please enter your login user password",
				strings_senderror:"Request failed ",
				strings_ok:"OK",
		}
		Lang == "zh"?Dynamic=dynamic_zh:Dynamic=dynamic_en;
		//禁止浏览器后退
		history.pushState(null, null, document.URL);
		window.addEventListener('popstate', function() {
			history.pushState(null, null, document.URL);
		});
		//获取用户信息
		$.ajax({
			async: true,
			cache: false,
			type: "get",
			url: "/api/options.open",
			data: {},
			success: function(data) { // 请求成功后处理函数。
				$(".lock-body img").attr("src", data.image);
				$(".lock-body h4").html(data.name);
				$("#not>b").html(data.name)
			},
			error: function() { // 请求失败处理函数
				alert(Dynamic.strings_writename);
			}
		});

		//i18n
		jQuery.i18n.properties({// 加载资浏览器语言对应的资源文件
			name : 'lock', // 资源文件名称
			path : '../i18n/', // 资源文件路径
			mode : 'both', // 用 Map 的方式使用资源文件中的值
			language : Lang,
			cache : false,
			encoding : 'UTF-8',
			callback : function() {// 加载成功后设置显示内容
				$("[data-i18n]").each(function() {
					$(this).html($.i18n.prop($(this).attr("data-i18n")))
				});
				$("input[data-place]").each(function(){
	   		 		$(this).attr("placeholder",$.i18n.prop($(this).attr("data-place")));
	   		 	});
			}
		});


		$(".goBack").click(function() {
			goBack();
		});
		$("body").on("keydown", function() {
			if (event.which == 13) {
				event.preventDefault();
				goBack();
			}
		})

		function goBack() {
			if ($('#z_password').val() == "") {
				swal({
					title: Dynamic.strings_writepassword,
					confirmButtonText: Dynamic.strings_ok
				});
				return false;
			}
			$.ajax({
				async: false,
				cache: false,
				type: "post",
				//dataType : "json", //返回json格式
				url: "/api/index.open",
				data: {
					username: $(".lock-body h4").html(),
					password: $('#z_password').val(),
					language: Lang

				},
				success: function(data) { //请求成功后处理函数。
					if (data == null) {
						swal({
							title: Dynamic.strings_wrongname,
							confirmButtonText: Dynamic.strings_ok,
							closeOnConfirm: false,
							type: "error"
						});
						return false;
					} else if (data.statu == 'fail') {
						swal({
							title: Dynamic.strings_wrongpassword,
							confirmButtonText: Dynamic.strings_ok,
							closeOnConfirm: false,
							type: "error"
						});
						return false;
					} else {
						window.location.href = localStorage.getItem("history");
						localStorage.removeItem("history")
					}
				},
				error: function() { //请求失败处理函数
					alert(Dynamic.strings_senderror);
					return false;
				}
			});
		}
	</script>
</body>

</html>
